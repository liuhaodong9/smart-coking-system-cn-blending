

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>login &mdash; Smart Coking System Documentation v1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/css/modify.css?v=49f62740" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=aabfef7a"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Smart Coking System Documentation
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/overview.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/installation.html">安装指南</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/coalData.html">coalData module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/coal_quality_model_AI.html">coal_quality_model_AI module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/DataProcess.html">DataProcess Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/Example.html">Example module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/genetic_algorithm_geatpy1.html">genetic_algorithm_geatpy1 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/genetic_algorithm_geatpy2.html">genetic_algorithm_geatpy2 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/login.html">login module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/ModelPredict.html">ModelPredict module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/typeClassfication.html">typeClassfication module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Smart Coking System Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">login</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for login</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">send_file</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">flask_cors</span> <span class="kn">import</span> <span class="n">CORS</span>
<span class="kn">from</span> <span class="nn">coalData</span> <span class="kn">import</span> <span class="n">CoalDataGeneration</span><span class="p">,</span><span class="n">app</span><span class="p">,</span><span class="n">db</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">jsonify</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">typeClassfication</span> <span class="kn">import</span> <span class="n">coaltypefind</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span> 
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geatpy</span> <span class="k">as</span> <span class="nn">ea</span>
<span class="kn">from</span> <span class="nn">genetic_algorithm_geatpy1</span> <span class="kn">import</span> <span class="n">MyProblem</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas.core.frame</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">from</span> <span class="nn">ModelPredict</span> <span class="kn">import</span> <span class="n">modelpredict</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<div class="viewcode-block" id="setup_seed"><a class="viewcode-back" href="../api/login.html#login.setup_seed">[docs]</a><span class="k">def</span> <span class="nf">setup_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    设置随机种子，以确保结果的可复现性。</span>
<span class="sd">    通过设置 NumPy 和 TensorFlow 的随机种子，确保每次运行的结果一致。</span>

<span class="sd">    参数:</span>
<span class="sd">        seed (int): 用于初始化随机数生成器的种子值。</span>

<span class="sd">    返回值:</span>
<span class="sd">        None: 本函数没有返回值，仅修改全局状态以设置随机种子。</span>

<span class="sd">    示例:</span>
<span class="sd">        设置随机种子为 42:</span>

<span class="sd">        ::</span>
<span class="sd">            setup_seed(42)</span>

<span class="sd">    注意:</span>
<span class="sd">        1. 调用 `np.random.seed(seed)` 为 NumPy 设置随机种子。</span>
<span class="sd">        2. 调用 `tf.random.set_seed(seed)` 为 TensorFlow 设置 CPU 随机种子。</span>
<span class="sd">        3. 通过设置环境变量 `os.environ[&#39;TF_DETERMINISTIC_OPS&#39;] = &#39;1&#39;` 为 TensorFlow 的 GPU 操作启用确定性行为。</span>
<span class="sd">           请确保安装了 `tensorflow-determinism` 库以支持 GPU 的完全确定性操作。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>  <span class="c1"># 为 NumPy 设置随机种子</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>  <span class="c1"># 为 TensorFlow 设置 CPU 随机种子</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TF_DETERMINISTIC_OPS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>  <span class="c1"># 为 TensorFlow GPU 设置随机种子</span></div>

<span class="n">setup_seed</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="c1"># 45:3.31330   47:3.31407</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>

<span class="c1"># 获取当前脚本所在的目录并拼接路径</span>
<span class="n">model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;model_weight&#39;</span><span class="p">)</span>

<span class="c1"># 加载模型</span>
<span class="c1"># model = keras.models.load_model(os.path.join(model_dir, &#39;predict_model.h5&#39;))</span>

<span class="c1"># 加载专家系统模型</span>
<span class="n">model_expert</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;Model_DIS_CSR.pkl&#39;</span><span class="p">))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;linear.pickle&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">linereg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;decisiontree.pickle&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">decisiontree</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;KNN.pickle&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">KNN</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;RF.pickle&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">RF</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;SVR_CRI.pickle&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">SVR_CRI</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;SVR_CSR.pickle&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">SVR_CSR</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;GradientBoostingRegressor_1.pickle&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">GradientBoostingRegressor_1</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s1">&#39;GradientBoostingRegressor_2.pickle&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">GradientBoostingRegressor_2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


<span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">supports_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#两个python文件都最好跨域,必须要有</span>
<span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="p">{</span><span class="sa">r</span><span class="s1">&#39;/*&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;origins&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">}})</span>

<span class="n">upload_classify</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#用于按钮点击上传煤分类</span>
<span class="n">upload_classify_user</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#用于按钮点击上传煤分类-用户</span>

<span class="n">account_name</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ustl&#39;</span><span class="p">:</span><span class="s1">&#39;ustl777888&#39;</span><span class="p">}</span> <span class="c1">#存放账号和密码</span>

<span class="c1">#登录界面</span>
<div class="viewcode-block" id="login"><a class="viewcode-back" href="../api/login.html#login.login">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    登录接口处理函数。</span>

<span class="sd">    处理登录请求：</span>
<span class="sd">        - 对于 POST 请求，验证用户提供的用户名和密码。</span>
<span class="sd">        - 对于 GET 请求，返回提示用户发送 POST 请求进行登录。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 HTTP 请求传递数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        对于 POST 请求:</span>
<span class="sd">            JSON: 返回登录验证结果，包含以下字段:</span>
<span class="sd">                message (str): 表示登录结果，&quot;success1&quot; 表示成功，&quot;fail&quot; 表示失败。</span>
<span class="sd">        对于 GET 请求:</span>
<span class="sd">            tuple: 返回包含提示信息字符串和 HTTP 状态码的元组。</span>

<span class="sd">    示例:</span>
<span class="sd">        1. POST 请求示例:</span>
<span class="sd">        ::</span>
<span class="sd">            POST /login</span>
<span class="sd">            {</span>
<span class="sd">                &quot;username&quot;: &quot;ustl&quot;,</span>
<span class="sd">                &quot;password&quot;: &quot;ustl777888&quot;</span>
<span class="sd">            }</span>

<span class="sd">        返回:</span>
<span class="sd">        ::</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;success1&quot;</span>
<span class="sd">            }</span>

<span class="sd">        2. GET 请求示例:</span>
<span class="sd">        ::</span>
<span class="sd">            GET /login</span>

<span class="sd">        返回:</span>
<span class="sd">        ::</span>
<span class="sd">            &quot;Please send a POST request with login credentials.&quot;, 200</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># 获取并解析 POST 请求中的数据</span>
        <span class="n">user_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>
        <span class="n">user_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>

        <span class="c1"># 验证用户名和密码</span>
        <span class="k">if</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ustl&#39;</span> <span class="ow">and</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ustl777888&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;success1&quot;</span><span class="p">)</span>  <span class="c1"># 返回 JSON 格式响应，表示登录成功</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;fail&quot;</span><span class="p">)</span>  <span class="c1"># 返回 JSON 格式响应，表示登录失败</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 处理 GET 请求，返回提示信息</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received a GET request on /login&quot;</span><span class="p">)</span>  <span class="c1"># 日志记录</span>
        <span class="k">return</span> <span class="s2">&quot;Please send a POST request with login credentials.&quot;</span><span class="p">,</span> <span class="mi">200</span> </div>

<span class="c1">#煤数据获取</span>
<div class="viewcode-block" id="getData"><a class="viewcode-back" href="../api/login.html#login.getData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/coalData&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    获取煤数据接口处理函数。</span>

<span class="sd">    根据查询参数返回煤数据：</span>
<span class="sd">    - 对于 GET 请求，根据查询参数 `query` 过滤煤种数据。</span>
<span class="sd">    - 如果 `query` 为空或未提供，则返回所有煤数据。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 HTTP 请求传递查询参数）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含煤数据查询结果的 JSON 格式响应，包含以下字段:</span>
<span class="sd">            msg (str): 煤数据查询结果，由 `CoalDataGeneration.response` 方法格式化。</span>

<span class="sd">    示例:</span>
<span class="sd">        1. 无查询参数时返回所有煤数据:</span>
<span class="sd">            ::</span>
<span class="sd">                GET /coalData</span>

<span class="sd">            返回:</span>
<span class="sd">            ::</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;msg&quot;: [</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;id&quot;: 1,</span>
<span class="sd">                            &quot;coal_type&quot;: &quot;Anthracite&quot;,</span>
<span class="sd">                            ...</span>
<span class="sd">                        },</span>
<span class="sd">                        ...</span>
<span class="sd">                    ]</span>
<span class="sd">                }</span>

<span class="sd">        2. 通过查询参数过滤煤种数据:</span>
<span class="sd">            ::</span>
<span class="sd">                GET /coalData?query=Anthracite</span>

<span class="sd">            返回:</span>
<span class="sd">            ::</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;msg&quot;: [</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;id&quot;: 1,</span>
<span class="sd">                            &quot;coal_type&quot;: &quot;Anthracite&quot;,</span>
<span class="sd">                            ...</span>
<span class="sd">                        }</span>
<span class="sd">                    ]</span>
<span class="sd">                }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="c1"># 获取查询参数</span>
        <span class="n">query_param</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># 查询数据库数据</span>
        <span class="k">if</span> <span class="n">query_param</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># 查询所有煤数据</span>
            <span class="n">coal_data</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 根据煤种类型过滤</span>
            <span class="n">coal_data</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">coal_type</span> <span class="o">==</span> <span class="n">query_param</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 使用响应方法格式化数据</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">coal_data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># 返回 JSON 格式响应</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="getDetailedData"><a class="viewcode-back" href="../api/login.html#login.getDetailedData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/coalDetailedData&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getDetailedData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    根据煤数据的 ID 查询煤的详细信息接口。</span>

<span class="sd">    处理逻辑:</span>

<span class="sd">        对于 GET 请求，通过查询参数 `id` 获取煤数据的 ID。</span>
<span class="sd">    </span>
<span class="sd">        查询数据库，返回对应的煤数据详细信息。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 HTTP 请求传递煤数据 ID）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含煤的详细信息的 JSON 格式响应，包含以下字段:</span>
<span class="sd">            msg (str): 煤的详细信息，由 `CoalDataGeneration.response` 方法格式化。</span>

<span class="sd">    示例:</span>
<span class="sd">        1. 查询煤的详细信息:</span>
<span class="sd">        ::</span>
<span class="sd">            GET /coalDetailedData?id=5</span>

<span class="sd">        返回:</span>
<span class="sd">        ::</span>
<span class="sd">            {</span>
<span class="sd">                &quot;msg&quot;: {</span>
<span class="sd">                    &quot;id&quot;: 5,</span>
<span class="sd">                    &quot;coal_type&quot;: &quot;Anthracite&quot;,</span>
<span class="sd">                    ...</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        2. 缺少 `id` 参数时的错误响应:</span>
<span class="sd">        ::</span>
<span class="sd">            GET /coalDetailedData</span>

<span class="sd">        返回:</span>
<span class="sd">        ::</span>
<span class="sd">            {</span>
<span class="sd">                &quot;msg&quot;: &quot;Error: Missing &#39;id&#39; parameter&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="c1"># 获取查询参数 &#39;id&#39;</span>
        <span class="n">query_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="c1"># 检查 ID 是否提供</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">query_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;Error: Missing &#39;id&#39; parameter&quot;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="c1"># 根据 ID 查询煤的详细数据</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">query_id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 格式化查询结果</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">query_result</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># 返回 JSON 格式响应</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="deleteCoalData"><a class="viewcode-back" href="../api/login.html#login.deleteCoalData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/deleteCoalData&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">deleteCoalData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    根据煤数据的 ID 删除煤的详细信息接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        对于 POST 请求，通过传递的煤数据 ID 删除对应的记录。如果未提供 ID 或记录不存在，返回相应的错误信息。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 HTTP 请求传递煤数据 ID）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        str: 删除操作的结果信息。</span>
<span class="sd">        </span>
<span class="sd">            成功时返回 &quot;delete successfully&quot;。</span>

<span class="sd">            如果 ID 对应的记录不存在，返回 &quot;Coal data not found&quot; 和 HTTP 状态码 404。</span>

<span class="sd">    示例:</span>
<span class="sd">        1. 删除煤数据记录:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /deleteCoalData?id=5</span>

<span class="sd">            返回:</span>
<span class="sd">            &quot;delete successfully&quot;</span>

<span class="sd">        2. 记录不存在时:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /deleteCoalData?id=100</span>

<span class="sd">            返回:</span>
<span class="sd">            &quot;Coal data not found&quot;, 404</span>

<span class="sd">        3. 缺少 ID 参数时:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /deleteCoalData</span>

<span class="sd">            返回:</span>
<span class="sd">            &quot;Error: Missing &#39;id&#39; paraeter&quot;, 400</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># 获取查询参数 &#39;id&#39;</span>
        <span class="n">query_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="c1"># 检查 ID 是否提供</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">query_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Error: Missing &#39;id&#39; parameter&quot;</span><span class="p">,</span> <span class="mi">400</span>

        <span class="c1"># 根据 ID 查询煤数据</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">query_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="c1"># 检查是否找到记录</span>
        <span class="k">if</span> <span class="n">query_result</span><span class="p">:</span>
            <span class="c1"># 删除记录并提交事务</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">query_result</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="s2">&quot;delete successfully&quot;</span>  <span class="c1"># 返回成功消息</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Coal data not found&quot;</span><span class="p">,</span> <span class="mi">404</span>  <span class="c1"># 返回未找到消息及状态码</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Invalid request method&quot;</span><span class="p">,</span> <span class="mi">405</span>  <span class="c1"># 不支持的请求方法</span></div>

<span class="c1"># #煤类别扇形图获取</span>
<span class="c1"># @app.route(&#39;/getFanData&#39;,methods=[&#39;POST&#39;,&#39;GET&#39;])</span>
<span class="c1"># def getFanData():</span>
<span class="c1">#     if request.method == &#39;GET&#39;:</span>
<span class="c1">#         CoalData = CoalDataGeneration.query.order_by(CoalDataGeneration.id.desc()).all()</span>
<span class="c1">#         res = {</span>
<span class="c1">#         &quot;msg&quot;: CoalDataGeneration.response_pie(None, CoalData=CoalData)</span>
<span class="c1">#         }</span>
<span class="c1">#         return jsonify(res)</span>

<span class="c1"># #煤价格直方图获取</span>
<span class="c1"># @app.route(&#39;/getPriceData&#39;,methods=[&#39;POST&#39;,&#39;GET&#39;])</span>
<span class="c1"># def getPriceData():</span>
<span class="c1">#     if request.method == &#39;GET&#39;:</span>
<span class="c1">#         CoalData = CoalDataGeneration.query.order_by(CoalDataGeneration.id.desc()).all()</span>
<span class="c1">#         res = {</span>
<span class="c1">#         &quot;msg&quot;: CoalDataGeneration.response_bar(None, CoalData=CoalData)</span>
<span class="c1">#         }</span>
<span class="c1">#         return jsonify(res)</span>

<div class="viewcode-block" id="getClassifyData"><a class="viewcode-back" href="../api/login.html#login.getClassifyData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getClassifyData&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getClassifyData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    接收煤数据并将其转化为 CSV 文件进行分类预测。</span>

<span class="sd">    处理逻辑: </span>
<span class="sd">        接收 POST 请求中的煤数据，解析后保存为 CSV 文件。</span>
<span class="sd">        </span>
<span class="sd">        调用煤分类预测函数 `coaltypefind` 对每条煤数据进行分类预测。</span>

<span class="sd">        返回包含每条数据的 ID、名称及预测类型的结果。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求传递煤数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回预测结果的 JSON 格式响应，包含以下字段:</span>

<span class="sd">            id (int): 煤数据的唯一标识。</span>

<span class="sd">            name (str): 煤数据的名称。</span>

<span class="sd">            predicted_type (str): 预测的煤类型或 &quot;判据不足&quot;。</span>

<span class="sd">    示例:</span>
<span class="sd">        1. 使用 POST 请求传递煤数据进行预测:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getClassifyResult</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                    &quot;coal_vdaf&quot;: 25.3,</span>
<span class="sd">                    &quot;coal_drynoash_hdaf&quot;: 5.6,</span>
<span class="sd">                    &quot;G&quot;: 1.2,</span>
<span class="sd">                    &quot;Y&quot;: 3.4,</span>
<span class="sd">                    &quot;b&quot;: 0.9</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                    &quot;predicted_type&quot;: &quot;Type 1&quot;</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">        2. 错误响应示例 (当请求方法不是 POST 时):</span>
<span class="sd">        ::</span>
<span class="sd">            Invalid request method</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="c1"># 从数据库中按 ID 降序获取所有煤数据记录</span>
        <span class="n">coal_data</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 使用响应方法格式化数据</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">coal_data</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># 返回 JSON 格式的响应</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 如果请求方法不是 GET，返回 405 错误</span>
        <span class="k">return</span> <span class="s2">&quot;Invalid request method&quot;</span><span class="p">,</span> <span class="mi">405</span></div>

<div class="viewcode-block" id="getClassifyResult"><a class="viewcode-back" href="../api/login.html#login.getClassifyResult">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getClassifyResult&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getClassifyResult</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    接收煤数据并将其转化为 CSV 文件进行分类预测。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        接收 POST 请求中的煤数据，解析后保存为 CSV 文件。</span>

<span class="sd">        调用煤分类预测函数 `coaltypefind` 对每条煤数据进行分类预测。</span>

<span class="sd">        返回包含每条数据的 ID、名称及预测类型的结果。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求传递煤数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回预测结果的 JSON 格式响应，包含以下字段:</span>

<span class="sd">            id (int): 煤数据的唯一标识。</span>

<span class="sd">            name (str): 煤数据的名称。</span>

<span class="sd">            predicted_type (str): 预测的煤类型或 &quot;判据不足&quot;。</span>

<span class="sd">    示例:</span>
<span class="sd">        1. 传递煤数据进行预测:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getClassifyResult</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                    &quot;coal_vdaf&quot;: 25.3,</span>
<span class="sd">                    &quot;coal_drynoash_hdaf&quot;: 5.6,</span>
<span class="sd">                    &quot;G&quot;: 1.2,</span>
<span class="sd">                    &quot;Y&quot;: 3.4,</span>
<span class="sd">                    &quot;b&quot;: 0.9</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                    &quot;predicted_type&quot;: &quot;Type 1&quot;</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">        2. 请求数据格式错误:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getClassifyResult</span>
<span class="sd">            { invalid json }</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Invalid JSON data&quot;</span>
<span class="sd">            }</span>

<span class="sd">        3. 输入数据缺少必要字段:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getClassifyResult</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Coal A&quot;</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Missing key in input data: &#39;coal_vdaf&#39;&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 验证请求方法</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Invalid request method&quot;</span><span class="p">,</span> <span class="mi">405</span>

    <span class="c1"># 获取并解析请求数据</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid JSON data&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># 初始化结果列表</span>
    <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># CSV 文件头部定义</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;Sample.csv&#39;</span>

    <span class="c1"># 遍历输入数据进行分类预测</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 提取相关参数</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;Test&#39;</span><span class="p">,</span>  <span class="c1"># 假设类型为 &quot;Test&quot;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_hdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
            <span class="p">]</span>

            <span class="c1"># 写入 CSV 文件</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">csv_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
                <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

            <span class="c1"># 调用煤分类预测函数</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">coaltypefind</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

            <span class="c1"># 构建分类结果</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">],</span>
                <span class="s2">&quot;predicted_type&quot;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">prediction</span> <span class="k">else</span> <span class="s2">&quot;判据不足&quot;</span>
            <span class="p">}</span>

            <span class="c1"># 添加结果到响应数组</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Missing key in input data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># 返回预测结果</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span></div>

<div class="viewcode-block" id="uploadClassifyResult"><a class="viewcode-back" href="../api/login.html#login.uploadClassifyResult">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uploadClassifyResult&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">uploadClassifyResult</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    将分类预测结果上传到数据库，并更新对应煤数据的类型。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        检查全局变量 `upload_classify` 是否包含分类结果。</span>

<span class="sd">        遍历 `upload_classify` 中的每条预测结果。</span>

<span class="sd">        根据预测结果的 `id` 更新数据库中对应记录的 `coal_type` 字段。</span>

<span class="sd">        提交更新到数据库。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传分类预测结果）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        str: 返回上传结果的响应字符串:</span>

<span class="sd">            &quot;upload successfully&quot;: 表示分类结果已成功上传。</span>

<span class="sd">    示例:</span>
<span class="sd">        上传分类预测结果至数据库:</span>
<span class="sd">        ::</span>
<span class="sd">            全局变量 `upload_classify` 包含以下数据:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;predicted_type&quot;: &quot;Type A&quot;</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 2,</span>
<span class="sd">                    &quot;predicted_type&quot;: &quot;Type B&quot;</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">            请求:</span>
<span class="sd">            POST /uploadClassifyResult</span>

<span class="sd">            返回:</span>
<span class="sd">            &quot;upload successfully&quot;</span>

<span class="sd">    注意事项:</span>
<span class="sd">        1. `upload_classify` 必须是一个已存储分类结果的全局变量，数据格式应包含以下字段:</span>
<span class="sd">            </span>
<span class="sd">            id (int): 煤数据的唯一标识。</span>
<span class="sd">            </span>
<span class="sd">            predicted_type (str): 分类预测的煤类型。</span>
<span class="sd">        </span>
<span class="sd">        2. 使用 SQLAlchemy 的 `update()` 方法批量更新数据库中的记录。</span>
<span class="sd">        </span>
<span class="sd">        3. 必须确保数据库会话 (`db.session`) 的提交成功。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 检查是否有分类结果可供上传</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">upload_classify</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 如果存在分类结果</span>
        <span class="c1"># 遍历每一条分类预测结果</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">upload_classify</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># 更新数据库中的煤类型字段</span>
                <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;coal_type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;predicted_type&#39;</span><span class="p">])})</span>
                <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># 提交更新到数据库</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>  <span class="c1"># 回滚事务</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Failed to update record with ID </span><span class="si">{</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">500</span>

    <span class="c1"># 返回成功提示</span>
    <span class="k">return</span> <span class="s2">&quot;upload successfully&quot;</span></div>

<span class="c1">#焦炭质量预测(AI模型)</span>
<div class="viewcode-block" id="getCokeQualityfyeResultAI"><a class="viewcode-back" href="../api/login.html#login.getCokeQualityfyeResultAI">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getCokeQualityfyeResultAI&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getCokeQualityfyeResultAI</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    接收煤炭数据并使用 AI 模型预测焦炭的质量参数（M25、M10、CRI、CSR等）</span>

<span class="sd">    Paremeters</span>
<span class="sd">    无（通过 POST 请求上传煤炭数据）</span>

<span class="sd">    Return</span>
<span class="sd">    返回一个包含预测结果的 JSON 格式响应，其中每个煤样品的预测结果包括：</span>
<span class="sd">    1. 预测的 M25、M10、CRI、CSR 值</span>
<span class="sd">    2. 真实的 M25、M10、CRI、CSR 值（如果存在）</span>
<span class="sd">    3. 预测误差（如有）</span>
<span class="sd">    4. 每个样本的平均误差（全体样本）</span>
<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    1. 从请求中读取煤炭数据。</span>
<span class="sd">    2. 处理并规范化数据（通过最大最小值标准化）。</span>
<span class="sd">    3. 使用预训练的 AI 模型对数据进行预测。</span>
<span class="sd">    4. 计算并存储每个煤样品的预测结果和误差。</span>
<span class="sd">    5. 返回预测结果，包含每个煤样品的详细信息。</span>

<span class="sd">    Notes</span>
<span class="sd">    1. 输入数据应包含多个煤样本的物理和化学参数，如煤的含水率、挥发分等。</span>
<span class="sd">    2. 模型预测值与实际值的误差（CRI 和 CSR）将计算并返回。</span>
<span class="sd">    3. 模型需要事先训练并加载（假定 `model` 已加载）。</span>

<span class="sd">    例如返回的 JSON 数据可能如下：</span>
<span class="sd">    ```json</span>
<span class="sd">    [</span>
<span class="sd">    {</span>
<span class="sd">    &quot;id&quot;: 1,</span>
<span class="sd">    &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">    &quot;M25&quot;: 10.25,</span>
<span class="sd">    &quot;M10&quot;: 5.30,</span>
<span class="sd">    &quot;CRI&quot;: 12.3,</span>
<span class="sd">    &quot;CSR&quot;: 25.1,</span>
<span class="sd">    &quot;real_M25&quot;: 10.0,</span>
<span class="sd">    &quot;real_M10&quot;: 5.0,</span>
<span class="sd">    &quot;real_CRI&quot;: 12.5,</span>
<span class="sd">    &quot;real_CSR&quot;: 25.0,</span>
<span class="sd">    &quot;error_CRI&quot;: &quot;1.6%&quot;,</span>
<span class="sd">    &quot;error_CSR&quot;: &quot;0.4%&quot;,</span>
<span class="sd">    &quot;total_error_CRI&quot;: &quot;1.2&quot;,</span>
<span class="sd">    &quot;total_error_CSR&quot;: &quot;0.3&quot;</span>
<span class="sd">    },</span>
<span class="sd">    ...</span>
<span class="sd">    ]</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    如果传入的数据中有 `None` 值（表示缺失数据），将返回一个包含 `&#39;Error&#39;` 的 JSON 响应。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 获取POST请求中的数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 将数据转换为JSON格式</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储待预测的数据</span>

        <span class="c1"># 数据预处理，将每个煤样品的特征值按顺序存储在 single_data 中</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">single_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># 如果存在缺失值，返回错误</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">single_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;Error&#39;</span><span class="p">])</span>
            <span class="n">np_predict_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>

        <span class="c1"># 数据标准化处理（归一化）</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.024</span><span class="p">,</span> <span class="mf">21.660</span><span class="p">,</span> <span class="mf">39.800</span><span class="p">,</span> <span class="mf">4.410</span><span class="p">,</span> <span class="mf">103.000</span><span class="p">,</span> <span class="mf">41.000</span><span class="p">,</span> <span class="mf">31.000</span><span class="p">])</span>  <span class="c1"># 最大值</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">7.03</span><span class="p">,</span> <span class="mf">21.36</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">56.46</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">11.63</span><span class="p">])</span>  <span class="c1"># 最小值</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_predict_data</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>  <span class="c1"># 标准化</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>

        <span class="c1"># 使用预训练模型进行预测</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测结果</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np_predict_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  <span class="c1"># 转换为浮动类型</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 保留两位小数</span>

        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 存储每个预测结果的字典</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储最终的预测结果列表</span>

        <span class="c1"># 计算每个样本的误差</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CRI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CSR</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CRI_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CSR_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">single_predicted_data</span> <span class="ow">in</span> <span class="n">np_predict_data</span><span class="p">:</span>
            <span class="c1"># 填充每个样本的预测值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;M25&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;M10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

            <span class="c1"># 真实值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_M25&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_M25&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_M10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_M10&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span>

            <span class="c1"># 计算误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CRI</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">valid_CRI_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CSR</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">valid_CSR_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 将单条数据加入最终结果</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>

            <span class="c1"># 计算并添加平均误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CRI</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CSR</span> <span class="o">/</span> <span class="n">valid_CSR_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>

            <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 重置字典</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># 存储最终结果到全局变量</span>
        <span class="k">global</span> <span class="n">upload_quality</span>
        <span class="n">upload_quality</span> <span class="o">=</span> <span class="n">response_result</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span>  <span class="c1"># 返回预测结果</span></div>

<span class="c1">#焦炭质量预测(AI线性回归模型)</span>
<div class="viewcode-block" id="getCokeQualityfyeResultAILinear"><a class="viewcode-back" href="../api/login.html#login.getCokeQualityfyeResultAILinear">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getCokeQualityfyeResultAILinear&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getCokeQualityfyeResultAILinear</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    接收煤炭数据并使用线性回归模型预测焦炭的质量参数（CRI、CSR等）。</span>

<span class="sd">    Paremeters</span>
<span class="sd">    无（通过 POST 请求上传煤炭数据）</span>

<span class="sd">    Return</span>
<span class="sd">    返回一个包含预测结果的 JSON 格式响应，其中每个煤样品的预测结果包括：</span>
<span class="sd">    - 预测的CRI和CSR值</span>
<span class="sd">    - 真实的CRI和CSR值（如果存在）</span>
<span class="sd">    - 预测误差（如有）</span>
<span class="sd">    - 每个样本的平均误差（全体样本）</span>

<span class="sd">    Example</span>
<span class="sd">    1. 从请求中读取煤炭数据。</span>
<span class="sd">    2. 处理并规范化数据（通过最大最小值标准化）。</span>
<span class="sd">    3. 使用线性回归模型对数据进行预测。</span>
<span class="sd">    4. 计算并存储每个煤样品的预测结果和误差。</span>
<span class="sd">    5. 返回预测结果，包含每个煤样品的详细信息。</span>

<span class="sd">    Notes</span>
<span class="sd">    如果传入的数据中有 `None` 值（表示缺失数据），将返回一个包含 `&#39;Error&#39;` 的 JSON 响应。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 获取POST请求中的数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 将数据转换为JSON格式</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储待预测的数据</span>

        <span class="c1"># 数据预处理，将每个煤样品的特征值按顺序存储在 single_data 中</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">single_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># 如果存在缺失值，返回错误</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">single_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;Error&#39;</span><span class="p">])</span>
            <span class="n">np_predict_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>

        <span class="c1"># 数据标准化处理（归一化）</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.024</span><span class="p">,</span> <span class="mf">21.660</span><span class="p">,</span> <span class="mf">39.800</span><span class="p">,</span> <span class="mf">4.410</span><span class="p">,</span> <span class="mf">103.000</span><span class="p">,</span> <span class="mf">41.000</span><span class="p">,</span> <span class="mf">31.000</span><span class="p">])</span>  <span class="c1"># 最大值</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">7.03</span><span class="p">,</span> <span class="mf">21.36</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">56.46</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">11.63</span><span class="p">])</span>  <span class="c1"># 最小值</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_predict_data</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>  <span class="c1"># 标准化</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>

        <span class="c1"># 使用线性回归模型进行预测</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">linereg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测结果</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np_predict_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  <span class="c1"># 转换为浮动类型</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 保留两位小数</span>

        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 存储每个预测结果的字典</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储最终的预测结果列表</span>

        <span class="c1"># 计算每个样本的误差</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CRI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CSR</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CRI_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CSR_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">single_predicted_data</span> <span class="ow">in</span> <span class="n">np_predict_data</span><span class="p">:</span>
            <span class="c1"># 填充每个样本的预测值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 预测的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 预测的CSR</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CSR</span>

            <span class="c1"># 计算CRI误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CRI</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CRI_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 计算CSR误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CSR</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CSR_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 将每个样本的预测结果添加到最终列表中</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>

            <span class="c1"># 计算并添加每个样本的平均误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CRI</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CSR</span> <span class="o">/</span> <span class="n">valid_CSR_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>

            <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 重置字典，准备下一条数据</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># 存储最终结果到全局变量</span>
        <span class="k">global</span> <span class="n">upload_quality</span>
        <span class="n">upload_quality</span> <span class="o">=</span> <span class="n">response_result</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span>  <span class="c1"># 返回预测结果</span></div>

<span class="c1">#焦炭质量预测(AI决策树模型)</span>
<div class="viewcode-block" id="getCokeQualityResultAIDecisionTree"><a class="viewcode-back" href="../api/login.html#login.getCokeQualityResultAIDecisionTree">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getCokeQualityResultAIDecisionTree&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getCokeQualityResultAIDecisionTree</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    使用决策树模型预测焦炭质量参数（CRI、CSR等）。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求，包含煤炭样品数据。</span>
<span class="sd">        - 数据预处理，包括特征提取和归一化。</span>
<span class="sd">        - 调用决策树模型分别预测 CRI 和 CSR。</span>
<span class="sd">        - 计算每个样品的预测误差，并返回预测结果及平均误差。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传煤炭数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含预测结果的 JSON 格式响应，其中每个样品包括以下字段:</span>
<span class="sd">            - id (int): 样品的唯一标识。</span>
<span class="sd">            - coal_name (str): 样品的名称。</span>
<span class="sd">            - predicted_CRI (float): 预测的 CRI 值。</span>
<span class="sd">            - predicted_CSR (float): 预测的 CSR 值。</span>
<span class="sd">            - real_CRI (float): 实际的 CRI 值（如果存在）。</span>
<span class="sd">            - real_CSR (float): 实际的 CSR 值（如果存在）。</span>
<span class="sd">            - error_CRI (str): CRI 的预测误差百分比。</span>
<span class="sd">            - error_CSR (str): CSR 的预测误差百分比。</span>
<span class="sd">            - total_error_CRI (float): 所有样品 CRI 的平均误差。</span>
<span class="sd">            - total_error_CSR (float): 所有样品 CSR 的平均误差。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求预测焦炭质量:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getCokeQualityResultAIDecisionTree</span>

<span class="sd">            数据:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                    &quot;coal_mad&quot;: 10.5,</span>
<span class="sd">                    &quot;coal_ad&quot;: 20.3,</span>
<span class="sd">                    &quot;coal_vdaf&quot;: 25.0,</span>
<span class="sd">                    &quot;coal_std&quot;: 1.2,</span>
<span class="sd">                    &quot;G&quot;: 0.5,</span>
<span class="sd">                    &quot;X&quot;: 1.3,</span>
<span class="sd">                    &quot;Y&quot;: 3.4,</span>
<span class="sd">                    &quot;coke_CRI&quot;: 12.0,</span>
<span class="sd">                    &quot;coke_CSR&quot;: 25.0</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;results&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                        &quot;predicted_CRI&quot;: 12.5,</span>
<span class="sd">                        &quot;predicted_CSR&quot;: 24.8,</span>
<span class="sd">                        &quot;real_CRI&quot;: 12.0,</span>
<span class="sd">                        &quot;real_CSR&quot;: 25.0,</span>
<span class="sd">                        &quot;error_CRI&quot;: &quot;4.17%&quot;,</span>
<span class="sd">                        &quot;error_CSR&quot;: &quot;0.80%&quot;,</span>
<span class="sd">                        &quot;total_error_CRI&quot;: 3.50,</span>
<span class="sd">                        &quot;total_error_CSR&quot;: 1.20</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 输入数据必须包含煤炭样品的所有必要特征。</span>
<span class="sd">        - 如果数据中有 `None` 值（表示缺失数据），返回包含 `&#39;Error&#39;` 的 JSON 响应。</span>
<span class="sd">        - 模型需要预先加载（假定 `decisiontree` 模型已加载）。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 获取POST请求中的数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 将数据转换为JSON格式</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储待预测的数据</span>

        <span class="c1"># 数据预处理，将每个煤样品的特征值按顺序存储在 single_data 中</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">single_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># 如果存在缺失值，返回错误</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">single_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;Error&#39;</span><span class="p">])</span>
            <span class="n">np_predict_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>

        <span class="c1"># 数据标准化处理（归一化）</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.024</span><span class="p">,</span> <span class="mf">21.660</span><span class="p">,</span> <span class="mf">39.800</span><span class="p">,</span> <span class="mf">4.410</span><span class="p">,</span> <span class="mf">103.000</span><span class="p">,</span> <span class="mf">41.000</span><span class="p">,</span> <span class="mf">31.000</span><span class="p">])</span>  <span class="c1"># 最大值</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">7.03</span><span class="p">,</span> <span class="mf">21.36</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">56.46</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">11.63</span><span class="p">])</span>  <span class="c1"># 最小值</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_predict_data</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>  <span class="c1"># 标准化</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>

        <span class="c1"># 使用决策树模型进行预测</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">decisiontree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测结果</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np_predict_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  <span class="c1"># 转换为浮动类型</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 保留两位小数</span>

        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 存储每个预测结果的字典</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储最终的预测结果列表</span>

        <span class="c1"># 计算每个样本的误差</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CRI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CSR</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CRI_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CSR_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">single_predicted_data</span> <span class="ow">in</span> <span class="n">np_predict_data</span><span class="p">:</span>
            <span class="c1"># 填充每个样本的预测值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 预测的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 预测的CSR</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CSR</span>

            <span class="c1"># 计算CRI误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CRI</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CRI_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 计算CSR误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CSR</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CSR_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 将每个样本的预测结果添加到最终列表中</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>

            <span class="c1"># 计算并添加每个样本的平均误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CRI</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CSR</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>

            <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 重置字典，准备下一条数据</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># 存储最终结果到全局变量</span>
        <span class="k">global</span> <span class="n">upload_quality</span>
        <span class="n">upload_quality</span> <span class="o">=</span> <span class="n">response_result</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span>  <span class="c1"># 返回预测结果</span></div>

<div class="viewcode-block" id="getCokeQualityfyeResultAIKNN"><a class="viewcode-back" href="../api/login.html#login.getCokeQualityfyeResultAIKNN">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getCokeQualityfyeResultAIKNN&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getCokeQualityfyeResultAIKNN</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    使用 KNN 模型预测焦炭质量参数（CRI、CSR等）。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求，包含煤炭样品数据。</span>
<span class="sd">        - 数据预处理，包括特征提取和归一化。</span>
<span class="sd">        - 调用 KNN 模型分别预测 CRI 和 CSR。</span>
<span class="sd">        - 计算每个样品的预测误差，并返回预测结果及平均误差。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传煤炭数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含预测结果的 JSON 格式响应，其中每个样品包括以下字段:</span>
<span class="sd">            - id (int): 样品的唯一标识。</span>
<span class="sd">            - coal_name (str): 样品的名称。</span>
<span class="sd">            - predicted_CRI (float): 预测的 CRI 值。</span>
<span class="sd">            - predicted_CSR (float): 预测的 CSR 值。</span>
<span class="sd">            - real_CRI (float): 实际的 CRI 值（如果存在）。</span>
<span class="sd">            - real_CSR (float): 实际的 CSR 值（如果存在）。</span>
<span class="sd">            - error_CRI (str): CRI 的预测误差百分比。</span>
<span class="sd">            - error_CSR (str): CSR 的预测误差百分比。</span>
<span class="sd">            - total_error_CRI (float): 所有样品 CRI 的平均误差。</span>
<span class="sd">            - total_error_CSR (float): 所有样品 CSR 的平均误差。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求预测焦炭质量:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getCokeQualityfyeResultAIKNN</span>

<span class="sd">            数据:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                    &quot;coal_mad&quot;: 10.5,</span>
<span class="sd">                    &quot;coal_ad&quot;: 20.3,</span>
<span class="sd">                    &quot;coal_vdaf&quot;: 25.0,</span>
<span class="sd">                    &quot;coal_std&quot;: 1.2,</span>
<span class="sd">                    &quot;G&quot;: 0.5,</span>
<span class="sd">                    &quot;X&quot;: 1.3,</span>
<span class="sd">                    &quot;Y&quot;: 3.4,</span>
<span class="sd">                    &quot;coke_CRI&quot;: 12.0,</span>
<span class="sd">                    &quot;coke_CSR&quot;: 25.0</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;results&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                        &quot;predicted_CRI&quot;: 12.5,</span>
<span class="sd">                        &quot;predicted_CSR&quot;: 24.8,</span>
<span class="sd">                        &quot;real_CRI&quot;: 12.0,</span>
<span class="sd">                        &quot;real_CSR&quot;: 25.0,</span>
<span class="sd">                        &quot;error_CRI&quot;: &quot;4.17%&quot;,</span>
<span class="sd">                        &quot;error_CSR&quot;: &quot;0.80%&quot;,</span>
<span class="sd">                        &quot;total_error_CRI&quot;: 3.50,</span>
<span class="sd">                        &quot;total_error_CSR&quot;: 1.20</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 输入数据必须包含煤炭样品的所有必要特征。</span>
<span class="sd">        - 如果数据中有 `None` 值（表示缺失数据），返回包含 `&#39;Error&#39;` 的 JSON 响应。</span>
<span class="sd">        - 模型需要预先加载（假定 `KNN` 模型已加载）。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 获取POST请求中的数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 将数据转换为JSON格式</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储待预测的数据</span>

        <span class="c1"># 数据预处理，将每个煤样品的特征值按顺序存储在 single_data 中</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">single_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># 如果存在缺失值，返回错误</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">single_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;Error&#39;</span><span class="p">])</span>
            <span class="n">np_predict_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>

        <span class="c1"># 数据标准化处理（归一化）</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.024</span><span class="p">,</span> <span class="mf">21.660</span><span class="p">,</span> <span class="mf">39.800</span><span class="p">,</span> <span class="mf">4.410</span><span class="p">,</span> <span class="mf">103.000</span><span class="p">,</span> <span class="mf">41.000</span><span class="p">,</span> <span class="mf">31.000</span><span class="p">])</span>  <span class="c1"># 最大值</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">7.03</span><span class="p">,</span> <span class="mf">21.36</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">56.46</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">11.63</span><span class="p">])</span>  <span class="c1"># 最小值</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_predict_data</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>  <span class="c1"># 标准化</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>

        <span class="c1"># 使用KNN模型进行预测</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">KNN</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测结果</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np_predict_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  <span class="c1"># 转换为浮动类型</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 保留两位小数</span>

        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 存储每个预测结果的字典</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储最终的预测结果列表</span>

        <span class="c1"># 计算每个样本的误差</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CRI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CSR</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CRI_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CSR_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">single_predicted_data</span> <span class="ow">in</span> <span class="n">np_predict_data</span><span class="p">:</span>
            <span class="c1"># 填充每个样本的预测值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 预测的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 预测的CSR</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CSR</span>

            <span class="c1"># 计算CRI误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CRI</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CRI_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 计算CSR误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CSR</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CSR_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 将每个样本的预测结果添加到最终列表中</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>

            <span class="c1"># 计算并添加每个样本的平均误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CRI</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CSR</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>

            <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 重置字典，准备下一条数据</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># 存储最终结果到全局变量</span>
        <span class="k">global</span> <span class="n">upload_quality</span>
        <span class="n">upload_quality</span> <span class="o">=</span> <span class="n">response_result</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span>  <span class="c1"># 返回预测结果</span></div>

<span class="c1">#焦炭质量预测(AIRF模型)</span>
<div class="viewcode-block" id="getCokeQualityfyeResultAIRF"><a class="viewcode-back" href="../api/login.html#login.getCokeQualityfyeResultAIRF">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getCokeQualityfyeResultAIRF&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getCokeQualityfyeResultAIRF</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    使用随机森林（RF）模型预测焦炭质量参数（CRI、CSR等）。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求，包含煤炭样品数据。</span>
<span class="sd">        - 数据预处理，包括特征提取和归一化。</span>
<span class="sd">        - 调用 RF 模型分别预测 CRI 和 CSR。</span>
<span class="sd">        - 计算每个样品的预测误差，并返回预测结果及平均误差。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传煤炭数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含预测结果的 JSON 格式响应，其中每个样品包括以下字段:</span>
<span class="sd">            - id (int): 样品的唯一标识。</span>
<span class="sd">            - coal_name (str): 样品的名称。</span>
<span class="sd">            - predicted_CRI (float): 预测的 CRI 值。</span>
<span class="sd">            - predicted_CSR (float): 预测的 CSR 值。</span>
<span class="sd">            - real_CRI (float): 实际的 CRI 值（如果存在）。</span>
<span class="sd">            - real_CSR (float): 实际的 CSR 值（如果存在）。</span>
<span class="sd">            - error_CRI (str): CRI 的预测误差百分比。</span>
<span class="sd">            - error_CSR (str): CSR 的预测误差百分比。</span>
<span class="sd">            - total_error_CRI (float): 所有样品 CRI 的平均误差。</span>
<span class="sd">            - total_error_CSR (float): 所有样品 CSR 的平均误差。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求预测焦炭质量:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getCokeQualityfyeResultAIRF</span>

<span class="sd">            数据:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                    &quot;coal_mad&quot;: 10.5,</span>
<span class="sd">                    &quot;coal_ad&quot;: 20.3,</span>
<span class="sd">                    &quot;coal_vdaf&quot;: 25.0,</span>
<span class="sd">                    &quot;coal_std&quot;: 1.2,</span>
<span class="sd">                    &quot;G&quot;: 0.5,</span>
<span class="sd">                    &quot;X&quot;: 1.3,</span>
<span class="sd">                    &quot;Y&quot;: 3.4,</span>
<span class="sd">                    &quot;coke_CRI&quot;: 12.0,</span>
<span class="sd">                    &quot;coke_CSR&quot;: 25.0</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;results&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                        &quot;predicted_CRI&quot;: 12.5,</span>
<span class="sd">                        &quot;predicted_CSR&quot;: 24.8,</span>
<span class="sd">                        &quot;real_CRI&quot;: 12.0,</span>
<span class="sd">                        &quot;real_CSR&quot;: 25.0,</span>
<span class="sd">                        &quot;error_CRI&quot;: &quot;4.17%&quot;,</span>
<span class="sd">                        &quot;error_CSR&quot;: &quot;0.80%&quot;,</span>
<span class="sd">                        &quot;total_error_CRI&quot;: 3.50,</span>
<span class="sd">                        &quot;total_error_CSR&quot;: 1.20</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 输入数据必须包含煤炭样品的所有必要特征。</span>
<span class="sd">        - 如果数据中有 `None` 值（表示缺失数据），返回包含 `&#39;Error&#39;` 的 JSON 响应。</span>
<span class="sd">        - 模型需要预先加载（假定 `RF` 模型已加载）。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 获取POST请求中的数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 将数据转换为JSON格式</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储待预测的数据</span>

        <span class="c1"># 数据预处理，将每个煤样品的特征值按顺序存储在 single_data 中</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">single_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># 如果存在缺失值，返回错误</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">single_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;Error&#39;</span><span class="p">])</span>
            <span class="n">np_predict_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>

        <span class="c1"># 数据标准化处理（归一化）</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.024</span><span class="p">,</span> <span class="mf">21.660</span><span class="p">,</span> <span class="mf">39.800</span><span class="p">,</span> <span class="mf">4.410</span><span class="p">,</span> <span class="mf">103.000</span><span class="p">,</span> <span class="mf">41.000</span><span class="p">,</span> <span class="mf">31.000</span><span class="p">])</span>  <span class="c1"># 最大值</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">7.03</span><span class="p">,</span> <span class="mf">21.36</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">56.46</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">11.63</span><span class="p">])</span>  <span class="c1"># 最小值</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_predict_data</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>  <span class="c1"># 标准化</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>

        <span class="c1"># 使用随机森林模型进行预测</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测结果</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np_predict_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  <span class="c1"># 转换为浮动类型</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 保留两位小数</span>

        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 存储每个预测结果的字典</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储最终的预测结果列表</span>

        <span class="c1"># 计算每个样本的误差</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CRI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CSR</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CRI_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CSR_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">single_predicted_data</span> <span class="ow">in</span> <span class="n">np_predict_data</span><span class="p">:</span>
            <span class="c1"># 填充每个样本的预测值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 预测的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 预测的CSR</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CSR</span>

            <span class="c1"># 计算CRI误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CRI</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CRI_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 计算CSR误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CSR</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CSR_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 将每个样本的预测结果添加到最终列表中</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>

            <span class="c1"># 计算并添加每个样本的平均误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CRI</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CSR</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>

            <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 重置字典，准备下一条数据</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># 存储最终结果到全局变量</span>
        <span class="k">global</span> <span class="n">upload_quality</span>
        <span class="n">upload_quality</span> <span class="o">=</span> <span class="n">response_result</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span>  <span class="c1"># 返回预测结果</span></div>

<span class="c1">#焦炭质量预测(AISVR模型)</span>
<div class="viewcode-block" id="getCokeQualityfyeResultAISVR"><a class="viewcode-back" href="../api/login.html#login.getCokeQualityfyeResultAISVR">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getCokeQualityfyeResultAISVR&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getCokeQualityfyeResultAISVR</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    使用支持向量回归（SVR）模型预测焦炭质量参数（CRI、CSR等）。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求，包含煤炭样品数据。</span>
<span class="sd">        - 数据预处理，包括特征提取和归一化。</span>
<span class="sd">        - 调用 SVR 模型分别预测 CRI 和 CSR。</span>
<span class="sd">        - 计算每个样品的预测误差，并返回预测结果及平均误差。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传煤炭数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含预测结果的 JSON 格式响应，其中每个样品包括以下字段:</span>
<span class="sd">            - id (int): 样品的唯一标识。</span>
<span class="sd">            - coal_name (str): 样品的名称。</span>
<span class="sd">            - predicted_CRI (float): 预测的 CRI 值。</span>
<span class="sd">            - predicted_CSR (float): 预测的 CSR 值。</span>
<span class="sd">            - real_CRI (float): 实际的 CRI 值（如果存在）。</span>
<span class="sd">            - real_CSR (float): 实际的 CSR 值（如果存在）。</span>
<span class="sd">            - error_CRI (str): CRI 的预测误差百分比。</span>
<span class="sd">            - error_CSR (str): CSR 的预测误差百分比。</span>
<span class="sd">            - total_error_CRI (float): 所有样品 CRI 的平均误差。</span>
<span class="sd">            - total_error_CSR (float): 所有样品 CSR 的平均误差。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求预测焦炭质量:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getCokeQualityfyeResultAISVR</span>

<span class="sd">            数据:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                    &quot;coal_mad&quot;: 10.5,</span>
<span class="sd">                    &quot;coal_ad&quot;: 20.3,</span>
<span class="sd">                    &quot;coal_vdaf&quot;: 25.0,</span>
<span class="sd">                    &quot;coal_std&quot;: 1.2,</span>
<span class="sd">                    &quot;G&quot;: 0.5,</span>
<span class="sd">                    &quot;X&quot;: 1.3,</span>
<span class="sd">                    &quot;Y&quot;: 3.4,</span>
<span class="sd">                    &quot;coke_CRI&quot;: 12.0,</span>
<span class="sd">                    &quot;coke_CSR&quot;: 25.0</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;results&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                        &quot;predicted_CRI&quot;: 12.5,</span>
<span class="sd">                        &quot;predicted_CSR&quot;: 24.8,</span>
<span class="sd">                        &quot;real_CRI&quot;: 12.0,</span>
<span class="sd">                        &quot;real_CSR&quot;: 25.0,</span>
<span class="sd">                        &quot;error_CRI&quot;: &quot;4.17%&quot;,</span>
<span class="sd">                        &quot;error_CSR&quot;: &quot;0.80%&quot;,</span>
<span class="sd">                        &quot;total_error_CRI&quot;: 3.50,</span>
<span class="sd">                        &quot;total_error_CSR&quot;: 1.20</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 输入数据必须包含煤炭样品的所有必要特征。</span>
<span class="sd">        - 如果数据中有 `None` 值（表示缺失数据），返回包含 `&#39;Error&#39;` 的 JSON 响应。</span>
<span class="sd">        - 模型需要预先加载（假定 `SVR_CRI` 和 `SVR_CSR` 已加载）。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 获取POST请求中的数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 将数据转换为JSON格式</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储待预测的数据</span>

        <span class="c1"># 数据预处理，将每个煤样品的特征值按顺序存储在 single_data 中</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">single_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># 如果存在缺失值，返回错误</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">single_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;Error&#39;</span><span class="p">])</span>
            <span class="n">np_predict_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>

        <span class="c1"># 数据标准化处理（归一化）</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.024</span><span class="p">,</span> <span class="mf">21.660</span><span class="p">,</span> <span class="mf">39.800</span><span class="p">,</span> <span class="mf">4.410</span><span class="p">,</span> <span class="mf">103.000</span><span class="p">,</span> <span class="mf">41.000</span><span class="p">,</span> <span class="mf">31.000</span><span class="p">])</span>  <span class="c1"># 最大值</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">7.03</span><span class="p">,</span> <span class="mf">21.36</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">56.46</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">11.63</span><span class="p">])</span>  <span class="c1"># 最小值</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_predict_data</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>  <span class="c1"># 标准化</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>

        <span class="c1"># 使用支持向量回归（SVR）模型分别预测CRI和CSR</span>
        <span class="n">np_predict_data_CRI</span> <span class="o">=</span> <span class="n">SVR_CRI</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测CRI值</span>
        <span class="n">np_predict_data_CSR</span> <span class="o">=</span> <span class="n">SVR_CSR</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测CSR值</span>

        <span class="c1"># 将结果重塑为二维数组</span>
        <span class="n">np_predict_data_CRI</span> <span class="o">=</span> <span class="n">np_predict_data_CRI</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np_predict_data_CRI</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">np_predict_data_CSR</span> <span class="o">=</span> <span class="n">np_predict_data_CSR</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np_predict_data_CSR</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># 合并两个预测结果（CRI 和 CSR）</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np_predict_data_CRI</span><span class="p">,</span> <span class="n">np_predict_data_CSR</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># 转换数据类型为浮点数，并保留两位小数</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np_predict_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 存储每个预测结果的字典</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储最终的预测结果列表</span>

        <span class="c1"># 计算每个样本的误差</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CRI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CSR</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CRI_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CSR_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">single_predicted_data</span> <span class="ow">in</span> <span class="n">np_predict_data</span><span class="p">:</span>
            <span class="c1"># 填充每个样本的预测值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 预测的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 预测的CSR</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CSR</span>

            <span class="c1"># 计算CRI误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CRI</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CRI_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 计算CSR误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CSR</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CSR_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 将每个样本的预测结果添加到最终列表中</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>

            <span class="c1"># 计算并添加每个样本的平均误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CRI</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CSR</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>

            <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 重置字典，准备下一条数据</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># 存储最终结果到全局变量</span>
        <span class="k">global</span> <span class="n">upload_quality</span>
        <span class="n">upload_quality</span> <span class="o">=</span> <span class="n">response_result</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span>  <span class="c1"># 返回预测结果</span></div>

<span class="c1">#焦炭质量预测(AIAIXGBoost模型)</span>
<div class="viewcode-block" id="getCokeQualityfyeResultAIXGBoost"><a class="viewcode-back" href="../api/login.html#login.getCokeQualityfyeResultAIXGBoost">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getCokeQualityfyeResultAIXGBoost&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getCokeQualityfyeResultAIXGBoost</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    使用 AICNN 模型预测焦炭质量参数（CRI、CSR等）。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求，包含煤炭样品数据。</span>
<span class="sd">        - 数据预处理，包括格式化和标准化。</span>
<span class="sd">        - 调用 AICNN 模型对样品数据进行预测。</span>
<span class="sd">        - 对预测结果加入高斯噪声以模拟误差。</span>
<span class="sd">        - 返回预测结果及误差分析。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传煤炭数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含预测结果的 JSON 格式响应，其中每个样品包括以下字段:</span>
<span class="sd">            - id (int): 样品的唯一标识。</span>
<span class="sd">            - coal_name (str): 样品的名称。</span>
<span class="sd">            - predicted_CRI (float): 预测的 CRI 值。</span>
<span class="sd">            - predicted_CSR (float): 预测的 CSR 值。</span>
<span class="sd">            - real_CRI (float): 实际的 CRI 值（如果存在）。</span>
<span class="sd">            - real_CSR (float): 实际的 CSR 值（如果存在）。</span>
<span class="sd">            - error_CRI (str): CRI 的预测误差百分比。</span>
<span class="sd">            - error_CSR (str): CSR 的预测误差百分比。</span>
<span class="sd">            - average_error_CRI (float): 所有样品 CRI 的平均误差。</span>
<span class="sd">            - average_error_CSR (float): 所有样品 CSR 的平均误差。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求预测焦炭质量:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getCokeQualityfyeResultCNN</span>

<span class="sd">            数据:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                    &quot;coal_properties&quot;: {...}</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 2,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Sample B&quot;,</span>
<span class="sd">                    &quot;coal_properties&quot;: {...}</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;results&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                        &quot;predicted_CRI&quot;: 12.5,</span>
<span class="sd">                        &quot;predicted_CSR&quot;: 25.3,</span>
<span class="sd">                        &quot;real_CRI&quot;: 12.0,</span>
<span class="sd">                        &quot;real_CSR&quot;: 25.0,</span>
<span class="sd">                        &quot;error_CRI&quot;: &quot;4.2%&quot;,</span>
<span class="sd">                        &quot;error_CSR&quot;: &quot;1.2%&quot;,</span>
<span class="sd">                        &quot;average_error_CRI&quot;: 3.5,</span>
<span class="sd">                        &quot;average_error_CSR&quot;: 2.0</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 输入数据必须包含每个样品的煤炭特性字段。</span>
<span class="sd">        - 如果数据中有 `None` 值（表示缺失数据），返回包含 `&#39;Error&#39;` 的 JSON 响应。</span>
<span class="sd">        - 模型预测结果将加入高斯噪声模拟误差。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 获取POST请求中的数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 将数据转换为JSON格式</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储待预测的数据</span>

        <span class="c1"># 数据预处理，将每个煤样品的特征值按顺序存储在 single_data 中</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">single_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># 如果存在缺失值，返回错误</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">single_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;Error&#39;</span><span class="p">])</span>
            <span class="n">np_predict_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>

        <span class="c1"># 数据标准化处理（归一化）</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.024</span><span class="p">,</span> <span class="mf">21.660</span><span class="p">,</span> <span class="mf">39.800</span><span class="p">,</span> <span class="mf">4.410</span><span class="p">,</span> <span class="mf">103.000</span><span class="p">,</span> <span class="mf">41.000</span><span class="p">,</span> <span class="mf">31.000</span><span class="p">])</span>  <span class="c1"># 最大值</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">7.03</span><span class="p">,</span> <span class="mf">21.36</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">56.46</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">11.63</span><span class="p">])</span>  <span class="c1"># 最小值</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_predict_data</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>  <span class="c1"># 标准化</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>

        <span class="c1"># 使用梯度提升回归模型分别预测CRI和CSR</span>
        <span class="n">np_predict_data_CRI</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor_1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测CRI值</span>
        <span class="n">np_predict_data_CSR</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor_2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>  <span class="c1"># 预测CSR值</span>

        <span class="c1"># 将结果重塑为二维数组</span>
        <span class="n">np_predict_data_CRI</span> <span class="o">=</span> <span class="n">np_predict_data_CRI</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np_predict_data_CRI</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">np_predict_data_CSR</span> <span class="o">=</span> <span class="n">np_predict_data_CSR</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np_predict_data_CSR</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># 合并两个预测结果（CRI 和 CSR）</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np_predict_data_CRI</span><span class="p">,</span> <span class="n">np_predict_data_CSR</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># 转换数据类型为浮点数，并保留两位小数</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np_predict_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 存储每个预测结果的字典</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储最终的预测结果列表</span>

        <span class="c1"># 计算每个样本的误差</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CRI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CSR</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CRI_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CSR_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">single_predicted_data</span> <span class="ow">in</span> <span class="n">np_predict_data</span><span class="p">:</span>
            <span class="c1"># 填充每个样本的预测值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 预测的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 预测的CSR</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CSR</span>

            <span class="c1"># 计算CRI误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CRI</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CRI_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 计算CSR误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CSR</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CSR_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 将每个样本的预测结果添加到最终列表中</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>

            <span class="c1"># 计算并添加每个样本的平均误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CRI</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CSR</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>

            <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 重置字典，准备下一条数据</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># 存储最终结果到全局变量</span>
        <span class="k">global</span> <span class="n">upload_quality</span>
        <span class="n">upload_quality</span> <span class="o">=</span> <span class="n">response_result</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span>  <span class="c1"># 返回预测结果</span></div>

<span class="c1">#焦炭质量预测(AICNN模型)</span>
<div class="viewcode-block" id="getCokeQualityfyeResultCNN"><a class="viewcode-back" href="../api/login.html#login.getCokeQualityfyeResultCNN">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getCokeQualityfyeResultCNN&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getCokeQualityfyeResultCNN</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    使用 AICNN 模型预测焦炭质量参数（CRI、CSR等）。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求，包含煤炭样品数据。</span>
<span class="sd">        - 数据预处理，包括格式化和标准化。</span>
<span class="sd">        - 调用 AICNN 模型对样品数据进行预测。</span>
<span class="sd">        - 对预测结果加入高斯噪声以模拟误差。</span>
<span class="sd">        - 返回预测结果及误差分析。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传煤炭数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含预测结果的 JSON 格式响应，其中每个样品包括以下字段:</span>
<span class="sd">            - id (int): 样品的唯一标识。</span>
<span class="sd">            - coal_name (str): 样品的名称。</span>
<span class="sd">            - predicted_CRI (float): 预测的 CRI 值。</span>
<span class="sd">            - predicted_CSR (float): 预测的 CSR 值。</span>
<span class="sd">            - real_CRI (float): 实际的 CRI 值（如果存在）。</span>
<span class="sd">            - real_CSR (float): 实际的 CSR 值（如果存在）。</span>
<span class="sd">            - error_CRI (str): CRI 的预测误差百分比。</span>
<span class="sd">            - error_CSR (str): CSR 的预测误差百分比。</span>
<span class="sd">            - average_error_CRI (float): 所有样品 CRI 的平均误差。</span>
<span class="sd">            - average_error_CSR (float): 所有样品 CSR 的平均误差。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求预测焦炭质量:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /getCokeQualityfyeResultCNN</span>
<span class="sd">            数据:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                    &quot;coal_properties&quot;: {...}</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 2,</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Sample B&quot;,</span>
<span class="sd">                    &quot;coal_properties&quot;: {...}</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;results&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Sample A&quot;,</span>
<span class="sd">                        &quot;predicted_CRI&quot;: 12.5,</span>
<span class="sd">                        &quot;predicted_CSR&quot;: 25.3,</span>
<span class="sd">                        &quot;real_CRI&quot;: 12.0,</span>
<span class="sd">                        &quot;real_CSR&quot;: 25.0,</span>
<span class="sd">                        &quot;error_CRI&quot;: &quot;4.2%&quot;,</span>
<span class="sd">                        &quot;error_CSR&quot;: &quot;1.2%&quot;,</span>
<span class="sd">                        &quot;average_error_CRI&quot;: 3.5,</span>
<span class="sd">                        &quot;average_error_CSR&quot;: 2.0</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 输入数据必须包含每个样品的煤炭特性字段。</span>
<span class="sd">        - 如果数据中有 `None` 值（表示缺失数据），返回包含 `&#39;Error&#39;` 的 JSON 响应。</span>
<span class="sd">        - 模型预测结果将加入高斯噪声模拟误差。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># 设置随机种子，保证结果可重复</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 获取POST请求中的数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 将数据转换为JSON格式</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储待预测的数据</span>

        <span class="c1"># 数据预处理，将每个煤样品的特征值按顺序存储在 single_data 中</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="n">single_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># 如果存在缺失值，返回错误</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">single_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;Error&#39;</span><span class="p">])</span>
            <span class="n">np_predict_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>

        <span class="c1"># 数据标准化处理（归一化）</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.024</span><span class="p">,</span> <span class="mf">21.660</span><span class="p">,</span> <span class="mf">39.800</span><span class="p">,</span> <span class="mf">4.410</span><span class="p">,</span> <span class="mf">103.000</span><span class="p">,</span> <span class="mf">41.000</span><span class="p">,</span> <span class="mf">31.000</span><span class="p">])</span>  <span class="c1"># 最大值</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">7.03</span><span class="p">,</span> <span class="mf">21.36</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">56.46</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">11.63</span><span class="p">])</span>  <span class="c1"># 最小值</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_predict_data</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span>  <span class="c1"># 标准化</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span>

        <span class="c1"># 使用随机森林模型进行预测，并加入高斯噪声</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np_predict_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">np_predict_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np_predict_data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 存储每个预测结果的字典</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储最终的预测结果列表</span>

        <span class="c1"># 计算每个样本的误差</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CRI</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">average_error_CSR</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CRI_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">valid_CSR_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">single_predicted_data</span> <span class="ow">in</span> <span class="n">np_predict_data</span><span class="p">:</span>
            <span class="c1"># 填充每个样本的预测值</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 预测的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_predicted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 预测的CSR</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CRI</span>
            <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepared_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span>  <span class="c1"># 真实的CSR</span>

            <span class="c1"># 计算CRI误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span>  <span class="c1"># 加入高斯噪声</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 保留两位小数</span>

                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CRI</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CRI_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 计算CSR误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span>  <span class="c1"># 加入高斯噪声</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 保留两位小数</span>

                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
                <span class="n">average_error_CSR</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 累加误差</span>
                <span class="n">valid_CSR_number</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 计数有效样本</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># 将每个样本的预测结果添加到最终列表中</span>
            <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>

            <span class="c1"># 计算并添加每个样本的平均误差</span>
            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CRI&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CRI</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CRI&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;real_CSR&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">average_error_CSR</span> <span class="o">/</span> <span class="n">valid_CRI_number</span><span class="p">))[:</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;total_error_CSR&#39;</span><span class="p">])</span>

            <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 重置字典，准备下一条数据</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># 存储最终结果到全局变量</span>
        <span class="k">global</span> <span class="n">upload_quality</span>
        <span class="n">upload_quality</span> <span class="o">=</span> <span class="n">response_result</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span>  <span class="c1"># 返回预测结果</span></div>

<span class="c1"># #焦炭质量预测(Expert system模型)</span>
<span class="c1"># @app.route(&#39;/getCokeQualityfyeResultExpertSystem&#39;,methods=[&#39;POST&#39;,&#39;GET&#39;])</span>
<span class="c1"># def getCokeQualityfyeResultExpertSystem():</span>
<span class="c1">#     if request.method == &#39;POST&#39;:</span>
<span class="c1">#         prepared_data = request.data   </span>
<span class="c1">#         prepared_data = json.loads(prepared_data)</span>
<span class="c1">#         np_predict_data = [] #存储被预测的数据</span>

<span class="c1">#         for data in prepared_data:</span>
<span class="c1">#             single_data = []</span>
<span class="c1">#             single_data.append(data[&#39;id&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;coal_mad&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;coal_ad&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;coal_vdaf&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;coal_std&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;coal_drynoash_hdaf&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;coal_drynoash_cdaf&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;coal_drynoash_odaf&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;Rmax&#39;])</span>
<span class="c1">#             single_data.append(np.nan)</span>
<span class="c1">#             single_data.append(data[&#39;G&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;X&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;Y&#39;])</span>
<span class="c1">#             single_data.append(data[&#39;coal_name&#39;])</span>
<span class="c1">#             np_predict_data.append(single_data)</span>
<span class="c1">#         data = DataFrame(np_predict_data)</span>
<span class="c1">#         data = data.rename(columns={0:&#39;Num&#39;,1:&#39;Mt&#39;,2:&#39;Ad&#39;,3:&#39;Vdaf&#39;,4:&#39;St,d&#39;,5:&#39;Hdaf&#39;,6:&#39;Cdaf&#39;,7:&#39;Odaf&#39;,8:&#39;Ro&#39;,9:&#39;V9-V13&#39;,10:&#39;G&#39;,11:&#39;X&#39;,12:&#39;Y&#39;})</span>
<span class="c1">#         data = data.iloc[:,0:12]</span>
<span class="c1">#         dis_r = modelpredict(data,model_expert)</span>
<span class="c1">#         dis_r = np.array(dis_r) #先将数据框转换为数组</span>
<span class="c1">#         dis_r = dis_r.tolist()</span>
<span class="c1">#         para_dict = {} # 读取的单条数据</span>
<span class="c1">#         response_result = [] # 将预测的数据存储在数组里</span>
<span class="c1">#         for single_predicted_data in range(len(dis_r)):</span>
<span class="c1">#             para_dict[&#39;id&#39;] = np_predict_data[single_predicted_data][0]</span>
<span class="c1">#             para_dict[&#39;coal_name&#39;] = np_predict_data[single_predicted_data][-1]</span>
<span class="c1">#             para_dict[&#39;CSR&#39;] = round(dis_r[single_predicted_data][0],2)</span>
<span class="c1">#             response_result.append(para_dict)</span>
<span class="c1">#             para_dict = {}       </span>
<span class="c1">#         global upload_quality_expert</span>
<span class="c1">#         upload_quality_expert = response_result</span>
<span class="c1">#     return jsonify(response_result)</span>

<span class="c1">#点击“上传预测结果结果按钮”上传结果至数据库(AI算法)</span>
<div class="viewcode-block" id="uploadQualityResult"><a class="viewcode-back" href="../api/login.html#login.uploadQualityResult">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uploadQualityResult&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">uploadQualityResult</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    将预测结果上传到数据库（针对 AI 算法预测的 CRI 和 CSR 值）。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 检查全局变量 `upload_quality` 是否包含预测结果。</span>
<span class="sd">        - 遍历每条预测结果，根据 `id` 查询数据库中的对应记录。</span>
<span class="sd">        - 更新数据库记录的 `predicted_CRI` 和 `predicted_CSR` 字段。</span>
<span class="sd">        - 提交所有更新到数据库。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传预测结果）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        str: 返回上传结果的响应字符串:</span>
<span class="sd">            - &quot;upload successfully&quot;: 表示所有预测结果已成功上传。</span>
<span class="sd">            - 错误响应包含失败的具体原因。</span>

<span class="sd">    示例:</span>
<span class="sd">        上传预测结果至数据库:</span>
<span class="sd">        ::</span>
<span class="sd">            假设全局变量 `upload_quality` 包含以下数据:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;CRI&quot;: 12.5,</span>
<span class="sd">                    &quot;CSR&quot;: 25.3</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 2,</span>
<span class="sd">                    &quot;CRI&quot;: 15.2,</span>
<span class="sd">                    &quot;CSR&quot;: 30.1</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">            请求:</span>
<span class="sd">            POST /uploadQualityResult</span>

<span class="sd">            返回:</span>
<span class="sd">            &quot;upload successfully&quot;</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - `upload_quality` 必须是一个包含预测结果的全局变量。</span>
<span class="sd">        - 每条数据应包含以下字段:</span>
<span class="sd">            - id (int): 样本的唯一标识。</span>
<span class="sd">            - CRI (float): 预测的 CRI 值。</span>
<span class="sd">            - CSR (float): 预测的 CSR 值。</span>
<span class="sd">        - 如果事务提交失败，将回滚所有更改并返回错误信息。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">upload_quality</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 如果上传的预测结果列表不为空</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">upload_quality</span><span class="p">:</span>  <span class="c1"># 遍历每一条预测结果</span>
            <span class="c1"># 查询数据库中与当前id匹配的记录，并更新其预测结果字段</span>
            <span class="n">query_data</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;predicted_CRI&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]),</span>
                <span class="s1">&#39;predicted_CSR&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">])</span>
            <span class="p">})</span>
            <span class="c1"># 提交事务，保存更新</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;upload successfully&#39;</span>  <span class="c1"># 返回上传成功的消息</span></div>

<span class="c1"># #点击“上传预测结果结果按钮”上传结果至数据库(专家系统算法)</span>
<span class="c1"># @app.route(&#39;/uploadQualityResultExpert&#39;,methods=[&#39;POST&#39;,&#39;GET&#39;])</span>
<span class="c1"># def uploadQualityResultEexpert():</span>
<span class="c1">#     if len(upload_quality_expert) != 0:</span>
<span class="c1">#         for i in upload_quality_expert:</span>
<span class="c1">#             query_data = CoalDataGeneration.query.filter(CoalDataGeneration.id == i[&#39;id&#39;]).update({&#39;predicted_CSR_expert&#39;:str(i[&#39;CSR&#39;])})</span>
<span class="c1">#             db.session.commit()</span>
<span class="c1">#     return &#39;upload successfully&#39;</span>

<span class="c1">#气煤</span>
<div class="viewcode-block" id="getQiCoalData"><a class="viewcode-back" href="../api/login.html#login.getQiCoalData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getQiCoal&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getQiCoalData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    查询气煤（QM45）数据接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 GET 请求。</span>
<span class="sd">        - 查询数据库中煤样类型为 &#39;QM45&#39; 的所有记录。</span>
<span class="sd">        - 返回包含查询结果的 JSON 格式响应。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 GET 请求获取数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含查询结果的 JSON 格式响应，包含以下字段:</span>
<span class="sd">            - msg (list): 包含所有煤样类型为 &#39;QM45&#39; 的记录。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 GET 请求查询气煤数据:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            GET /getQiCoal</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;msg&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;QM45&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    },</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 2,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal B&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;QM45&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 查询结果为空时，返回的 `msg` 为一个空列表。</span>
<span class="sd">        - 如果请求方法不是 GET，将返回 405 错误。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>  <span class="c1"># 如果请求方法为GET</span>
        <span class="c1"># 查询数据库中 &#39;coal_type&#39; 为 &#39;QM45&#39; 的所有记录</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">coal_type</span> <span class="o">==</span> <span class="s1">&#39;QM45&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 创建响应字典</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">query_result</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># 返回JSON格式的响应</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
        <span class="c1"># CoalData = CoalDataGeneration.query.order_by(CoalDataGeneration.id.desc()).all()</span>
        <span class="c1"># res = {</span>
        <span class="c1"># &quot;msg&quot;: CoalDataGeneration.response(None, CoalData=CoalData)</span>
        <span class="c1"># }</span>
        <span class="c1"># return jsonify(res)</span>

<div class="viewcode-block" id="getFeiCoalgData"><a class="viewcode-back" href="../api/login.html#login.getFeiCoalgData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getFeiCoal&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getFeiCoalgData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    查询肥煤（FM36）数据接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 GET 请求。</span>
<span class="sd">        - 查询数据库中煤样类型为 &#39;FM36&#39; 的所有记录。</span>
<span class="sd">        - 返回包含查询结果的 JSON 格式响应。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 GET 请求获取数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含查询结果的 JSON 格式响应，包含以下字段:</span>
<span class="sd">            - msg (list): 包含所有煤样类型为 &#39;FM36&#39; 的记录。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 GET 请求查询肥煤数据:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            GET /getFeiCoal</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;msg&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;FM36&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    },</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 2,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal B&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;FM36&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 查询结果为空时，返回的 `msg` 为一个空列表。</span>
<span class="sd">        - 如果请求方法不是 GET，将返回 405 错误。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>  <span class="c1"># 如果请求方法为GET</span>
        <span class="c1"># 查询数据库中 &#39;coal_type&#39; 为 &#39;FM36&#39; 的所有记录</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">coal_type</span> <span class="o">==</span> <span class="s1">&#39;FM36&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 创建响应字典</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">query_result</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># 返回JSON格式的响应</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
        <span class="c1"># CoalData = CoalDataGeneration.query.order_by(CoalDataGeneration.id.desc()).all()</span>
        <span class="c1"># res = {</span>
        <span class="c1"># &quot;msg&quot;: CoalDataGeneration.response(None, CoalData=CoalData)</span>
        <span class="c1"># }</span>
        <span class="c1"># return jsonify(res)</span>

<div class="viewcode-block" id="getQiFeiCoalData"><a class="viewcode-back" href="../api/login.html#login.getQiFeiCoalData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getQiFeiCoal&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getQiFeiCoalData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    查询气肥煤（QF46）数据接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 GET 请求。</span>
<span class="sd">        - 查询数据库中煤样类型为 &#39;QF46&#39; 的所有记录。</span>
<span class="sd">        - 返回包含查询结果的 JSON 格式响应。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 GET 请求获取数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含查询结果的 JSON 格式响应，包含以下字段:</span>
<span class="sd">            - msg (list): 包含所有煤样类型为 &#39;QF46&#39; 的记录。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 GET 请求查询气肥煤数据:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            GET /getQiFeiCoal</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;msg&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;QF46&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    },</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 2,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal B&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;QF46&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 查询结果为空时，返回的 `msg` 为一个空列表。</span>
<span class="sd">        - 如果请求方法不是 GET，将返回 405 错误。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>  <span class="c1"># 如果请求方法为 GET</span>
        <span class="c1"># 查询数据库中 &#39;coal_type&#39; 为 &#39;QF46&#39; 的所有记录</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">coal_type</span> <span class="o">==</span> <span class="s1">&#39;QF46&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 创建响应字典</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">query_result</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># 返回 JSON 格式的响应</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
        <span class="c1"># CoalData = CoalDataGeneration.query.order_by(CoalDataGeneration.id.desc()).all()</span>
        <span class="c1"># res = {</span>
        <span class="c1"># &quot;msg&quot;: CoalDataGeneration.response(None, CoalData=CoalData)</span>
        <span class="c1"># }</span>
        <span class="c1"># return jsonify(res)</span>

<div class="viewcode-block" id="get31JiaoCoalgData"><a class="viewcode-back" href="../api/login.html#login.get31JiaoCoalgData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get31JiaoCoal&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get31JiaoCoalgData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    查询1/3焦煤（1/3JM35）数据接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 GET 请求。</span>
<span class="sd">        - 查询数据库中煤样类型为 &#39;1/3JM35&#39; 的所有记录。</span>
<span class="sd">        - 返回包含查询结果的 JSON 格式响应。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 GET 请求获取数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含查询结果的 JSON 格式响应，包含以下字段:</span>
<span class="sd">            - msg (list): 包含所有煤样类型为 &#39;1/3JM35&#39; 的记录。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 GET 请求查询1/3焦煤数据:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            GET /get31JiaoCoal</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;msg&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;1/3JM35&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    },</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 2,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal B&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;1/3JM35&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 查询结果为空时，返回的 `msg` 为一个空列表。</span>
<span class="sd">        - 如果请求方法不是 GET，将返回 405 错误。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>  <span class="c1"># 如果请求方法为 GET</span>
        <span class="c1"># 查询数据库中 &#39;coal_type&#39; 为 &#39;1/3JM35&#39; 的所有记录</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">coal_type</span> <span class="o">==</span> <span class="s1">&#39;1/3JM35&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 创建响应字典</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">query_result</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># 返回 JSON 格式的响应</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
        <span class="c1"># CoalData = CoalDataGeneration.query.order_by(CoalDataGeneration.id.desc()).all()</span>
        <span class="c1"># res = {</span>
        <span class="c1"># &quot;msg&quot;: CoalDataGeneration.response(None, CoalData=CoalData)</span>
        <span class="c1"># }</span>
        <span class="c1"># return jsonify(res)</span>

<div class="viewcode-block" id="getJiaoCoalData"><a class="viewcode-back" href="../api/login.html#login.getJiaoCoalData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getJiaoCoal&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getJiaoCoalData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    查询焦煤（JM25 和 JM24）数据接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 GET 请求。</span>
<span class="sd">        - 分别查询数据库中煤样类型为 &#39;JM25&#39; 和 &#39;JM24&#39; 的所有记录。</span>
<span class="sd">        - 合并查询结果并返回包含所有数据的 JSON 格式响应。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 GET 请求获取数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含查询结果的 JSON 格式响应，包含以下字段:</span>
<span class="sd">            - msg (list): 包含所有煤样类型为 &#39;JM25&#39; 和 &#39;JM24&#39; 的记录。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 GET 请求查询焦煤数据:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            GET /getJiaoCoal</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;msg&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;JM25&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    },</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 2,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal B&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;JM24&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 查询结果为空时，返回的 `msg` 为一个空列表。</span>
<span class="sd">        - 如果请求方法不是 GET，将返回 405 错误。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>  <span class="c1"># 如果请求方法为 GET</span>
        <span class="c1"># 查询煤样类型为 &#39;JM25&#39; 的所有记录</span>
        <span class="n">query_result_1</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">coal_type</span> <span class="o">==</span> <span class="s1">&#39;JM25&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 查询煤样类型为 &#39;JM24&#39; 的所有记录</span>
        <span class="n">query_result_2</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">coal_type</span> <span class="o">==</span> <span class="s1">&#39;JM24&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># 合并这两组查询结果</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="n">query_result_1</span> <span class="o">+</span> <span class="n">query_result_2</span>

        <span class="c1"># 创建响应字典</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">query_result</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># 返回 JSON 格式的响应</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
        <span class="c1"># CoalData = CoalDataGeneration.query.order_by(CoalDataGeneration.id.desc()).all()</span>
        <span class="c1"># res = {</span>
        <span class="c1"># &quot;msg&quot;: CoalDataGeneration.response(None, CoalData=CoalData)</span>
        <span class="c1"># }</span>
        <span class="c1"># return jsonify(res)</span>

<div class="viewcode-block" id="getShouCoalData"><a class="viewcode-back" href="../api/login.html#login.getShouCoalData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getShouCoal&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">getShouCoalData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    查询瘦煤（SM）数据接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 GET 请求。</span>
<span class="sd">        - 查询数据库中煤样类型为 &#39;SM&#39; 的所有记录。</span>
<span class="sd">        - 如果查询结果为空，返回 404 错误。</span>
<span class="sd">        - 返回包含查询结果的 JSON 格式响应。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 GET 请求获取数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含查询结果的 JSON 格式响应，包含以下字段:</span>
<span class="sd">            - msg (list): 包含所有煤样类型为 &#39;SM&#39; 的记录。</span>
<span class="sd">        如果未找到数据:</span>
<span class="sd">            - error (str): 错误信息。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 GET 请求查询瘦煤数据:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            GET /getShouCoal</span>

<span class="sd">            成功返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;msg&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: 1,</span>
<span class="sd">                        &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                        &quot;coal_type&quot;: &quot;SM&quot;,</span>
<span class="sd">                        ...</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">            数据为空时返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;No data found for &#39;SM&#39;&quot;</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 查询结果为空时返回 404 错误。</span>
<span class="sd">        - 如果请求方法不是 GET，将返回 405 错误。</span>
<span class="sd">        - 捕获所有异常并返回 500 错误。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
            <span class="c1"># 查询煤样类型为 &#39;SM&#39; 的所有记录</span>
            <span class="n">query_result</span> <span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">coal_type</span> <span class="o">==</span> <span class="s1">&#39;SM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">query_result</span><span class="p">:</span>
                <span class="c1"># 如果没有找到数据，返回错误提示</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;No data found for &#39;SM&#39;&quot;</span><span class="p">}),</span> <span class="mi">404</span>

            <span class="c1"># 返回查询结果</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">CoalDataGeneration</span><span class="o">.</span><span class="n">response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">CoalData</span><span class="o">=</span><span class="n">query_result</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="mi">200</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># 捕获异常并返回 500 错误</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while fetching &#39;SM&#39; data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;An error occurred while fetching data&quot;</span><span class="p">}),</span> <span class="mi">500</span></div>
        <span class="c1"># CoalData = CoalDataGeneration.query.order_by(CoalDataGeneration.id.desc()).all()</span>
        <span class="c1"># res = {</span>
        <span class="c1"># &quot;msg&quot;: CoalDataGeneration.response(None, CoalData=CoalData)</span>
        <span class="c1"># }</span>
        <span class="c1"># return jsonify(res)</span>

<span class="c1">#接收配煤数据和配煤比</span>
<div class="viewcode-block" id="predictBlendCoal"><a class="viewcode-back" href="../api/login.html#login.predictBlendCoal">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/predictBlendCoalQuality&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">predictBlendCoal</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    该路径根据输入的煤样数据和比例预测混合煤的质量特征。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收一个包含煤种信息和比例的列表。</span>
<span class="sd">        - 对每个煤种的特征进行加权计算，得出混合煤的综合特征。</span>

<span class="sd">    参数:</span>
<span class="sd">        prepared_data (list of dict): 包含多个煤种信息的列表，每个煤种信息包含以下字段</span>
<span class="sd">        ::</span>
<span class="sd">            coalRatio (float): 煤种的比例，范围为 0-100。</span>

<span class="sd">            coal_mad (float): 煤种的绝对湿度（MAD）。</span>

<span class="sd">            coal_ad (float): 煤种的空气干燥（AD）。</span>

<span class="sd">            coal_vdaf (float): 煤种的挥发分（VDAF）。</span>

<span class="sd">            coal_std (float): 煤种的标准化分（STD）。</span>

<span class="sd">            G (float): 煤种的G值（可自定义）。</span>

<span class="sd">            X (float): 煤种的X值（可自定义）。</span>

<span class="sd">            Y (float): 煤种的Y值（可自定义）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        list: 返回一个包含混合煤质量特征的字典。每个字典包含</span>
<span class="sd">        ::</span>
<span class="sd">            blendCoal_mad (float): 混合煤的绝对湿度。</span>

<span class="sd">            blendCoal_ad (float): 混合煤的空气干燥。</span>

<span class="sd">            blendCoal_vdaf (float): 混合煤的挥发分。</span>

<span class="sd">            blendCoal_std (float): 混合煤的标准化分。</span>

<span class="sd">            blendCoal_G (float): 混合煤的G值。</span>

<span class="sd">            blendCoal_X (float): 混合煤的X值。</span>

<span class="sd">            blendCoal_Y (float): 混合煤的Y值。</span>

<span class="sd">    示例:</span>
<span class="sd">        输入的煤样数据如下：</span>
<span class="sd">        ::</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;coalRatio&quot;: 40,</span>
<span class="sd">                    &quot;coal_mad&quot;: 10.5,</span>
<span class="sd">                    &quot;coal_ad&quot;: 20.3,</span>
<span class="sd">                    &quot;coal_vdaf&quot;: 25.0,</span>
<span class="sd">                    &quot;coal_std&quot;: 18.4,</span>
<span class="sd">                    &quot;G&quot;: 0.5,</span>
<span class="sd">                    &quot;X&quot;: 1.2,</span>
<span class="sd">                    &quot;Y&quot;: 3.4</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;coalRatio&quot;: 60,</span>
<span class="sd">                    &quot;coal_mad&quot;: 11.2,</span>
<span class="sd">                    &quot;coal_ad&quot;: 21.5,</span>
<span class="sd">                    &quot;coal_vdaf&quot;: 26.3,</span>
<span class="sd">                    &quot;coal_std&quot;: 19.1,</span>
<span class="sd">                    &quot;G&quot;: 0.6,</span>
<span class="sd">                    &quot;X&quot;: 1.3,</span>
<span class="sd">                    &quot;Y&quot;: 3.5</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>
<span class="sd">        返回的混合煤质量特征将是：</span>
<span class="sd">        ::</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;blendCoal_mad&quot;: 10.9,</span>
<span class="sd">                    &quot;blendCoal_ad&quot;: 20.9,</span>
<span class="sd">                    &quot;blendCoal_vdaf&quot;: 25.6,</span>
<span class="sd">                    &quot;blendCoal_std&quot;: 18.8,</span>
<span class="sd">                    &quot;blendCoal_G&quot;: 0.57,</span>
<span class="sd">                    &quot;blendCoal_X&quot;: 1.24,</span>
<span class="sd">                    &quot;blendCoal_Y&quot;: 3.43</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">    注意:</span>
<span class="sd">        - 确保输入的煤种比例总和为100%。</span>
<span class="sd">        - 返回的结果会根据比例进行加权计算。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># 获取请求数据</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>
        <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">)</span>  <span class="c1"># 解析请求数据</span>

        <span class="c1"># 初始化混合煤的各项质量特征</span>
        <span class="n">blendCoal_mad</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blendCoal_ad</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blendCoal_vdaf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blendCoal_std</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blendCoal_G</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blendCoal_X</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">blendCoal_Y</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># 遍历所有输入的煤种数据</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">:</span>
            <span class="c1"># 计算煤种比例</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;coalRatio&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="c1"># 按比例计算混合煤的质量特征</span>
            <span class="n">blendCoal_mad</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="n">blendCoal_ad</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="n">blendCoal_vdaf</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="n">blendCoal_std</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="n">blendCoal_G</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="n">blendCoal_X</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="n">blendCoal_Y</span> <span class="o">+=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span>

        <span class="c1"># 将混合煤各项质量特征四舍五入保留两位小数</span>
        <span class="n">blendCoal_mad</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">blendCoal_mad</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">blendCoal_ad</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">blendCoal_ad</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">blendCoal_vdaf</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">blendCoal_vdaf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">blendCoal_std</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">blendCoal_std</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">blendCoal_G</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">blendCoal_G</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">blendCoal_X</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">blendCoal_X</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">blendCoal_Y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">blendCoal_Y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># 返回预测结果</span>
        <span class="n">return_result</span> <span class="o">=</span> <span class="p">[{</span>
            <span class="s2">&quot;blendCoal_mad&quot;</span><span class="p">:</span> <span class="n">blendCoal_mad</span><span class="p">,</span>
            <span class="s1">&#39;blendCoal_ad&#39;</span><span class="p">:</span> <span class="n">blendCoal_ad</span><span class="p">,</span>
            <span class="s1">&#39;blendCoal_vdaf&#39;</span><span class="p">:</span> <span class="n">blendCoal_vdaf</span><span class="p">,</span>
            <span class="s1">&#39;blendCoal_std&#39;</span><span class="p">:</span> <span class="n">blendCoal_std</span><span class="p">,</span>
            <span class="s1">&#39;blendCoal_G&#39;</span><span class="p">:</span> <span class="n">blendCoal_G</span><span class="p">,</span>
            <span class="s1">&#39;blendCoal_X&#39;</span><span class="p">:</span> <span class="n">blendCoal_X</span><span class="p">,</span>
            <span class="s1">&#39;blendCoal_Y&#39;</span><span class="p">:</span> <span class="n">blendCoal_Y</span>
        <span class="p">}]</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">return_result</span><span class="p">)</span></div>

<span class="c1">#最优配煤比预测</span>
<div class="viewcode-block" id="predictBestRatio"><a class="viewcode-back" href="../api/login.html#login.predictBestRatio">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/predictBestRatio&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">predictBestRatio</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    预测最优配煤比。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求，包含煤样数据（如煤价、煤种特性等）。</span>
<span class="sd">        - 使用差分进化算法（Differential Evolution）进行优化。</span>
<span class="sd">        - 优化目标是满足给定的质量要求（如 CRI、CSR、M10、M25），同时降低成本。</span>
<span class="sd">        - 返回优化结果，包括最优配煤比和最低成本价格。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传煤样数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含最优配煤比和最低成本价格的 JSON 格式响应:</span>
<span class="sd">        ::</span>
<span class="sd">            {</span>
<span class="sd">                &quot;best_ratio&quot;: [0.4, 0.3, 0.3],</span>
<span class="sd">                &quot;lowest_cost&quot;: 1200.0</span>
<span class="sd">            }</span>
<span class="sd">        如果出现错误:</span>
<span class="sd">        ::</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Failed to predict optimal coal ratio.&quot;</span>
<span class="sd">            }</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求进行最优配煤比预测:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /predictBestRatio</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                    &quot;price&quot;: 120.0,</span>
<span class="sd">                    &quot;CRI&quot;: 10.2,</span>
<span class="sd">                    &quot;CSR&quot;: 25.4,</span>
<span class="sd">                    &quot;M10&quot;: 5.0,</span>
<span class="sd">                    &quot;M25&quot;: 12.5</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;coal_name&quot;: &quot;Coal B&quot;,</span>
<span class="sd">                    &quot;price&quot;: 110.0,</span>
<span class="sd">                    &quot;CRI&quot;: 11.0,</span>
<span class="sd">                    &quot;CSR&quot;: 26.0,</span>
<span class="sd">                    &quot;M10&quot;: 4.8,</span>
<span class="sd">                    &quot;M25&quot;: 12.0</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">            返回:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;best_ratio&quot;: [0.5, 0.5],</span>
<span class="sd">                &quot;lowest_cost&quot;: 1150.0</span>
<span class="sd">            }</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 输入数据应包括每种煤的价格和质量特性（CRI、CSR、M10、M25 等）。</span>
<span class="sd">        - 输入数据的比例将被优化，确保总和为 1。</span>
<span class="sd">        - 如果算法无法收敛或数据格式有误，返回错误响应。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># 解析请求数据</span>
        <span class="n">prepared_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        
        <span class="c1"># 输入维度，决策变量的上下界和边界</span>
        <span class="n">inputDim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 输入维数</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inputDim</span><span class="p">)]</span>  <span class="c1"># 决策变量下界</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inputDim</span><span class="p">)]</span>  <span class="c1"># 决策变量上界</span>
        <span class="n">lbin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inputDim</span><span class="p">)]</span>  <span class="c1"># 下边界的包含指示器</span>
        <span class="n">ubin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inputDim</span><span class="p">)]</span>  <span class="c1"># 上边界的包含指示器</span>
        
        <span class="c1"># 价格数组</span>
        <span class="n">price_array</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;coal_price&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;NoPrice&#39;</span><span class="p">]))</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">([</span><span class="s1">&#39;NoPrice&#39;</span><span class="p">])</span>
            <span class="n">price_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;coal_price&#39;</span><span class="p">])</span>

        <span class="c1"># 单煤的各项属性</span>
        <span class="n">CRI_value</span><span class="p">,</span> <span class="n">CSR_value</span><span class="p">,</span> <span class="n">M10_value</span><span class="p">,</span> <span class="n">M25_value</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prepared_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">CRI_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">])</span>
            <span class="n">CSR_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">])</span>
            <span class="n">M10_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;coke_M10&#39;</span><span class="p">])</span>
            <span class="n">M25_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;coke_M25&#39;</span><span class="p">])</span>

        <span class="c1"># 限制条件范围</span>
        <span class="n">CRI_min</span><span class="p">,</span> <span class="n">CRI_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">CSR_min</span><span class="p">,</span> <span class="n">CSR_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">M10_min</span><span class="p">,</span> <span class="n">M10_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">M25_min</span><span class="p">,</span> <span class="n">M25_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepared_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span>

        <span class="c1"># 创建优化问题实例</span>
        <span class="n">problem</span> <span class="o">=</span> <span class="n">MyProblem</span><span class="p">(</span>
            <span class="n">inputDim</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">lbin</span><span class="p">,</span> <span class="n">ubin</span><span class="p">,</span> <span class="n">price_array</span><span class="p">,</span>
            <span class="n">CRI_value</span><span class="p">,</span> <span class="n">CSR_value</span><span class="p">,</span> <span class="n">M10_value</span><span class="p">,</span> <span class="n">M25_value</span><span class="p">,</span>
            <span class="n">CRI_min</span><span class="p">,</span> <span class="n">CRI_max</span><span class="p">,</span> <span class="n">CSR_min</span><span class="p">,</span> <span class="n">CSR_max</span><span class="p">,</span>
            <span class="n">M10_min</span><span class="p">,</span> <span class="n">M10_max</span><span class="p">,</span> <span class="n">M25_min</span><span class="p">,</span> <span class="n">M25_max</span>
        <span class="p">)</span>

        <span class="c1"># 初始化算法参数</span>
        <span class="n">Encoding</span> <span class="o">=</span> <span class="s1">&#39;RI&#39;</span>  <span class="c1"># 编码方式</span>
        <span class="n">NIND</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># 种群规模</span>
        <span class="n">Field</span> <span class="o">=</span> <span class="n">ea</span><span class="o">.</span><span class="n">crtfld</span><span class="p">(</span><span class="n">Encoding</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">varTypes</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">ranges</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">borders</span><span class="p">)</span>  <span class="c1"># 创建区域描述器</span>
        <span class="n">population</span> <span class="o">=</span> <span class="n">ea</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">Encoding</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">NIND</span><span class="p">)</span>  <span class="c1"># 创建种群</span>
        <span class="n">myAlgorithm</span> <span class="o">=</span> <span class="n">ea</span><span class="o">.</span><span class="n">soea_DE_rand_1_L_templet</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">population</span><span class="p">)</span>  <span class="c1"># 实例化算法模板</span>

        <span class="c1"># 配置算法参数</span>
        <span class="n">myAlgorithm</span><span class="o">.</span><span class="n">MAXGEN</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1"># 最大进化代数</span>
        <span class="n">myAlgorithm</span><span class="o">.</span><span class="n">mutOper</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># 差分进化中的参数F</span>
        <span class="n">myAlgorithm</span><span class="o">.</span><span class="n">recOper</span><span class="o">.</span><span class="n">XOVR</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># 重组概率</span>
        <span class="n">myAlgorithm</span><span class="o">.</span><span class="n">drawing</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 关闭绘图</span>

        <span class="c1"># 执行算法</span>
        <span class="p">[</span><span class="n">NDSet</span><span class="p">,</span> <span class="n">population</span><span class="p">]</span> <span class="o">=</span> <span class="n">myAlgorithm</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">population</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># 保存最后一代种群信息</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal ratio for coal blending:&quot;</span><span class="p">,</span> <span class="n">NDSet</span><span class="o">.</span><span class="n">Phen</span><span class="p">)</span>  <span class="c1"># 输出最优配煤比</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lowest cost price:&quot;</span><span class="p">,</span> <span class="n">NDSet</span><span class="o">.</span><span class="n">ObjV</span><span class="p">)</span>  <span class="c1"># 输出最低成本价格</span>

        <span class="c1"># 返回结果</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NDSet</span><span class="o">.</span><span class="n">Phen</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">return_result</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">NDSet</span><span class="o">.</span><span class="n">Phen</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>  <span class="c1"># 最优配煤比</span>
                <span class="n">NDSet</span><span class="o">.</span><span class="n">ObjV</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>   <span class="c1"># 最低价格</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return_result</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">return_result</span><span class="p">)</span></div>

<span class="c1">#原煤数据的导入及上传</span>
<div class="viewcode-block" id="uploadCoalData"><a class="viewcode-back" href="../api/login.html#login.uploadCoalData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/UploadCoalData&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">uploadCoalData</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    上传原煤数据并存储到数据库。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求，上传煤样数据文件。</span>
<span class="sd">        - 读取上传的 Excel 文件内容，将数据逐条解析为标准化格式。</span>
<span class="sd">        - 根据模板字段填充每条煤样数据，数据中缺失值用 None 替代。</span>
<span class="sd">        - 将解析后的煤样数据存储到数据库。</span>
<span class="sd">        - 返回上传成功的消息。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传 Excel 文件）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        str: 返回 &quot;upload successfully&quot; 表示上传成功。</span>
<span class="sd">        如果发生异常，将返回错误消息。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求上传煤样数据:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /UploadCoalData</span>
<span class="sd">            上传文件: upload_coal.xlsx</span>

<span class="sd">            Excel 文件内容示例:</span>
<span class="sd">            +------------+-------+--------+----------+----------+----------+----------+-----+-----+</span>
<span class="sd">            | 煤样名称     | 煤种  | 价格(吨) | 煤样水分(Mad) | 煤样灰分(Ad) | 煤样挥发分(Vdaf) | 氢(Hdaf) | ... |</span>
<span class="sd">            +------------+-------+--------+----------+----------+----------+----------+-----+-----+</span>
<span class="sd">            | Coal Sample A | JM24  | 1000   | 10.5     | 15.2     | 25.3     | 1.5      | ... | ... |</span>
<span class="sd">            +------------+-------+--------+----------+----------+----------+----------+-----+-----+</span>

<span class="sd">            返回:</span>
<span class="sd">            &quot;upload successfully&quot;</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 上传文件必须为符合模板的 Excel 文件。</span>
<span class="sd">        - 数据中的 NaN 值将替换为 None。</span>
<span class="sd">        - 数据存储前，将字段值与模板匹配。</span>
<span class="sd">        - 数据表中的字段包括煤种类型、价格、挥发分等。</span>

<span class="sd">    错误处理:</span>
<span class="sd">        - 如果文件上传失败或解析出错，将返回详细的错误信息。</span>
<span class="sd">        - 如果数据库存储失败，将回滚事务，确保数据一致性。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># 获取上传的文件并保存到指定路径</span>
        <span class="n">Upload_coal_file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
        <span class="n">Upload_coal_file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;../src/assets/Upload_files/upload_coal.xlsx&quot;</span><span class="p">)</span>  <span class="c1"># 保存上传的文件</span>

        <span class="c1"># 初始化煤数据参数字典</span>
        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coal_name&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_belong&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_type&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_price&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ori_coal_13mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;ori_coal_13_10mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ori_coal_10_8mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ori_coal_8_6mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ori_coal_6_5mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s2">&quot;ori_coal_5_4mm&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ori_coal_4_3mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ori_coal_3_2mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ori_coal_2_1mm&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s2">&quot;ori_coal_1_05mm&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ori_coal_05mm&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ori_coal_total&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ori_coal_fineness&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;sma_coal_moi&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sma__coal_6mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sma__coal_6_5mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sma__coal_5_4mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;sma__coal_4_3mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sma__coal_3_2mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sma__coal_2_1mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sma__coal_1_05mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;sma__coal_05mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sma__coal_total&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sma_coal_fineness&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_mad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coal_ad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_vdaf&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_fcd&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_vd&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_ada&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_vad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coal_fcad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_std&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_ana_had&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_ana_cad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_ana_nad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coal_ana_oad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_dry_hd&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_dry_cd&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_dry_nd&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_dry_od&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coal_drynoash_hdaf&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_drynoash_cdaf&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_drynoash_ndaf&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coal_drynoash_odaf&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;T1&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;T2&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;T3&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Tp&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;Tmax&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Tk&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;amax&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Tk_Tp&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;DT&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ST&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;HT&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;FT&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;SiO2&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Al2O3&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Fe2O3&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;CaO&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;MgO&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;P2O5&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Na2O&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;K2O&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;TiO2&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;SO3&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ash_total&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;live_idle_ratio&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;Rmax&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;micro_var&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;micro_type&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;oven_type&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coking_style&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;dry_quality&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;heap_density&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;oven_moi&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;up_temper&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;down_number&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;hot_coke_qulity&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;hot_ratio_coke&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;quench_coke_weight&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_moi&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ratio_coke&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coking_date&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coking_process_time&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coking_start_time&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;center_100_time&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;center_500_time&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;center_900_time&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coking_end_time&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coking_end_temp&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_mad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_ad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coke_vdaf&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_fcd&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_vd&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_aad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_vad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_fcad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coke_std&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_80mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_80_60mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_60_40mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_40_25mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coke_25_20mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_20_10mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_10mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_5mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_sum&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_60mm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coke_fineness&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_M40&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_M25&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_M10&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_CRI&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_CSR&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coke_DT&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_ST&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_HT&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_FT&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_750&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_800&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coke_850&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_900&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_950&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_1000&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_1050&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_1100&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coke_1150&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_1200&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_apparent_porosity&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_real_density&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;coke_fake_density&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="s1">&#39;coke_total_ratio&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="c1"># 读取并处理上传的煤数据</span>
        <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;../src/assets/Upload_files/upload_coal.xlsx&quot;</span><span class="p">)</span>
        <span class="n">read_data</span> <span class="o">=</span> <span class="n">read_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>  <span class="c1"># 将nan替换成_</span>

        <span class="n">upload_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储煤样数据</span>

        <span class="c1"># 遍历读取的每一行数据，并按字段填充字典</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">read_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样名称&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤种&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;价格(吨)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样水分(Mad)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样灰分(Ad)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样挥发分(Vdaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_fcd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样固定碳(FCd)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样硫分(St,d)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_hdaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;氢(Hdaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_cdaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;碳(Cdaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_ndaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;氮(Ndaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_odaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;氧(Odaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;粘结指数(G)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;a/%&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;b/%&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tp/℃&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tmax/℃&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tk/℃&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;amax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;αmax/度/分&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tk_Tp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tk-Tp&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;变形温度(DT)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;ST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;软化温度(ST)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;HT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;半球温度(HT)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;FT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;流动温度(FT)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;SiO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;SiO2&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Al2O3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Al2O3&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Fe2O3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Fe2O3&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CaO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CaO&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;MgO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;MgO&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;P2O5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;P2O5&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Na2O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Na2O&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;K2O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;K2O&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;TiO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;TiO2&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;SO3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;SO3&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;镜质组(V)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;惰质组(I)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;壳质组(E)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;矿物(M)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;live_idle_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;活惰比&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Rmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;平均最大反射率(Rmax)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;micro_var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;标准方差&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;micro_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;类型&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;oven_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;炉型&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;dry_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;入炉干基质量/kg&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;heap_density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;堆密度t/m³&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;oven_moi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;入炉煤水分%&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;炼焦日期&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;入炉时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_100_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;中心到100℃时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_500_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;中心到500℃时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_900_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;中心到900℃时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;出炉时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_end_temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;出炉中心温度℃&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_mad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;焦炭水分(Mad)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_ad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;焦炭灰分(Ad)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;焦炭硫分(St,d)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M40&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;M40&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M25&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;M25&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;M10&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span> <span class="c1"># 将_识别的出的对应nan都转换成None</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> 

                <span class="n">new_coal_data</span><span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="p">(</span><span class="n">coal_name</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">],</span><span class="n">coal_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_type&#39;</span><span class="p">],</span><span class="n">coal_price</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_price&#39;</span><span class="p">],</span><span class="n">coal_mad</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span><span class="n">coal_ad</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span><span class="n">coal_vdaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span><span class="n">coal_fcd</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_fcd&#39;</span><span class="p">],</span><span class="n">coal_std</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span><span class="n">coal_drynoash_hdaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_hdaf&#39;</span><span class="p">],</span><span class="n">coal_drynoash_cdaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_cdaf&#39;</span><span class="p">],</span><span class="n">coal_drynoash_ndaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_ndaf&#39;</span><span class="p">],</span><span class="n">coal_drynoash_odaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_odaf&#39;</span><span class="p">],</span><span class="n">G</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span><span class="n">X</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">Y</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">a</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span><span class="n">b</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span><span class="n">Tp</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tp&#39;</span><span class="p">],</span><span class="n">Tmax</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tmax&#39;</span><span class="p">],</span><span class="n">Tk</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tk&#39;</span><span class="p">],</span><span class="n">amax</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;amax&#39;</span><span class="p">],</span><span class="n">Tk_Tp</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tk_Tp&#39;</span><span class="p">],</span><span class="n">DT</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">],</span><span class="n">ST</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;ST&#39;</span><span class="p">],</span><span class="n">HT</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;HT&#39;</span><span class="p">],</span><span class="n">FT</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;FT&#39;</span><span class="p">],</span><span class="n">SiO2</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;SiO2&#39;</span><span class="p">],</span><span class="n">Al2O3</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Al2O3&#39;</span><span class="p">],</span><span class="n">Fe2O3</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Fe2O3&#39;</span><span class="p">],</span><span class="n">CaO</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CaO&#39;</span><span class="p">],</span><span class="n">MgO</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;MgO&#39;</span><span class="p">],</span><span class="n">P2O5</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;P2O5&#39;</span><span class="p">],</span><span class="n">Na2O</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Na2O&#39;</span><span class="p">],</span><span class="n">K2O</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;K2O&#39;</span><span class="p">],</span><span class="n">TiO2</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;TiO2&#39;</span><span class="p">],</span><span class="n">SO3</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;SO3&#39;</span><span class="p">],</span><span class="n">V</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">],</span><span class="n">I</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span><span class="n">E</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span><span class="n">M</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">],</span><span class="n">live_idle_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;live_idle_ratio&#39;</span><span class="p">],</span><span class="n">Rmax</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Rmax&#39;</span><span class="p">],</span><span class="n">micro_var</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;micro_var&#39;</span><span class="p">],</span><span class="n">micro_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;micro_type&#39;</span><span class="p">],</span><span class="n">oven_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;oven_type&#39;</span><span class="p">],</span><span class="n">dry_quality</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;dry_quality&#39;</span><span class="p">],</span><span class="n">heap_density</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;heap_density&#39;</span><span class="p">],</span><span class="n">oven_moi</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;oven_moi&#39;</span><span class="p">],</span><span class="n">coking_date</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_date&#39;</span><span class="p">],</span><span class="n">coking_start_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_start_time&#39;</span><span class="p">],</span><span class="n">center_100_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_100_time&#39;</span><span class="p">],</span><span class="n">center_500_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_500_time&#39;</span><span class="p">],</span><span class="n">center_900_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_900_time&#39;</span><span class="p">],</span><span class="n">coking_end_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_end_time&#39;</span><span class="p">],</span><span class="n">coking_end_temp</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_end_temp&#39;</span><span class="p">],</span><span class="n">coke_mad</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_mad&#39;</span><span class="p">],</span><span class="n">coke_ad</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_ad&#39;</span><span class="p">],</span><span class="n">coke_std</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_std&#39;</span><span class="p">],</span><span class="n">coke_M40</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M40&#39;</span><span class="p">],</span><span class="n">coke_M25</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M25&#39;</span><span class="p">],</span><span class="n">coke_M10</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M10&#39;</span><span class="p">],</span><span class="n">coke_CRI</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">],</span><span class="n">coke_CSR</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">])</span>
                <span class="n">upload_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_coal_data</span><span class="p">)</span> <span class="c1"># 将所有所有数据存入列表中</span>
                <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coal_name&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_belong&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_type&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_price&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_13mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_13_10mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_10_8mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_8_6mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_6_5mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_5_4mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_4_3mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_3_2mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_2_1mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_1_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma_coal_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_6mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_6_5mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_5_4mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_4_3mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_3_2mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_2_1mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_1_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma_coal_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_mad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_fcd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ada&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_fcad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_std&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_had&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_cad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_nad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_oad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_hd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_cd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_nd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_od&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_hdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_cdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_ndaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_odaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;G&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;X&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Y&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T1&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tmax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tk&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;amax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tk_Tp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;DT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ST&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;HT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;FT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;SiO2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Al2O3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Fe2O3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;CaO&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;MgO&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;P2O5&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Na2O&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;K2O&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;TiO2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;SO3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ash_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;V&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;I&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;E&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;live_idle_ratio&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Rmax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;micro_var&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;micro_type&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;oven_type&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_style&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;dry_quality&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;heap_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;oven_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;up_temper&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;down_number&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;hot_coke_qulity&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;hot_ratio_coke&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;quench_coke_weight&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ratio_coke&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_date&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_process_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_start_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_100_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_500_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_900_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_end_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_end_temp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_mad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_ad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fcd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_aad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fcad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_std&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_80mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_80_60mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_60_40mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_40_25mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_25_20mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_20_10mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_10mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_5mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_sum&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_60mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M40&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M25&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M10&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_CRI&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_CSR&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_DT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_ST&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_HT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_FT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_750&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_800&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_850&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_900&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_950&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1000&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1050&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1100&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1150&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1200&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_apparent_porosity&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_real_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fake_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_total_ratio&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="n">upload_list</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;upload successfully&#39;</span></div>

<span class="c1"># 下载煤数据上传模板</span>
<div class="viewcode-block" id="Download"><a class="viewcode-back" href="../api/login.html#login.Download">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/templatedownload&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">Download</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    下载煤数据上传模板接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 当访问 `/templatedownload` 路径时，返回煤数据上传参考模板的文件。</span>
<span class="sd">        - 模板文件是一个 Excel 文件，包含上传数据所需的字段格式说明。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 GET 请求触发下载）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        Flask response: 返回模板文件作为附件下载。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 GET 请求下载模板文件:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            GET /templatedownload</span>

<span class="sd">            返回:</span>
<span class="sd">            浏览器会弹出下载对话框，提供以下文件下载:</span>
<span class="sd">            上传数据参考模板.xlsx</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 确保模板文件路径正确且文件存在，否则可能引发 404 错误。</span>
<span class="sd">        - 下载的文件名为 `上传数据参考模板.xlsx`。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 返回模板文件</span>
        <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="s1">&#39;../src/assets/上传数据参考模板.xlsx&#39;</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="c1"># 如果文件不存在，返回 404 错误</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Template file not found&quot;</span><span class="p">}),</span> <span class="mi">404</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># 捕获其他异常并返回 500 错误</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">500</span></div>
    
<div class="viewcode-block" id="DownloaUserGuide"><a class="viewcode-back" href="../api/login.html#login.DownloaUserGuide">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/userguidedownload&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">DownloaUserGuide</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    下载用户手册接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 当访问 `/userguidedownload` 路径时，返回系统用户手册的文件。</span>
<span class="sd">        - 用户手册文件是一个 PDF 文件，包含系统使用说明。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 GET 请求触发下载）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        Flask response: 返回用户手册文件作为附件下载。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 GET 请求下载用户手册:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            GET /userguidedownload</span>

<span class="sd">            返回:</span>
<span class="sd">            浏览器会弹出下载对话框，提供以下文件下载。</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 确保用户手册文件路径正确且文件存在，否则可能引发 404 错误。</span>
<span class="sd">        - 下载的文件名为 `用于焦炭质量预测与配煤智能化决策的AI辅助专家系统_用户手册.pdf`。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 返回用户手册文件</span>
        <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="s1">&#39;../src/assets/用于焦炭质量预测与配煤智能化决策的AI辅助专家系统_用户手册.pdf&#39;</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="c1"># 如果文件不存在，返回 404 错误</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;User guide file not found&quot;</span><span class="p">}),</span> <span class="mi">404</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># 捕获其他异常并返回 500 错误</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">500</span></div>

<div class="viewcode-block" id="uploadUserCoalData"><a class="viewcode-back" href="../api/login.html#login.uploadUserCoalData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/UploadUserCoalData&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">uploadUserCoalData</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    上传用户自选煤数据接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 接收 POST 请求上传用户自选的煤数据文件。</span>
<span class="sd">        - 将上传的文件保存到指定路径，供后续分类或处理使用。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传 Excel 文件）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        str: 返回 &quot;upload successfully&quot; 表示上传成功。</span>
<span class="sd">        如果发生异常，返回错误信息。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求上传煤数据:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /UploadUserCoalData</span>
<span class="sd">            上传文件: user_coal_data.xlsx</span>

<span class="sd">            返回:</span>
<span class="sd">            ::</span>
<span class="sd">            &quot;upload successfully&quot;</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 上传的文件必须为 Excel 格式（如 `.xlsx` 或 `.xls`）。</span>
<span class="sd">        - 文件将被保存到 `../src/assets/Upload_files/upload_coal.xlsx` 路径。</span>
<span class="sd">        - 确保目标目录存在且具有写入权限。</span>

<span class="sd">    错误处理:</span>
<span class="sd">        - 如果文件上传失败或保存出错，将返回详细的错误消息。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 获取上传的文件</span>
            <span class="n">upload_coal_file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
            <span class="c1"># 保存文件到指定路径</span>
            <span class="n">upload_coal_file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;../src/assets/Upload_files/upload_coal.xlsx&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;upload successfully&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># 捕获异常并返回错误信息</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;An error occurred while uploading the file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span>

    <span class="k">return</span> <span class="s2">&quot;Invalid request method&quot;</span><span class="p">,</span> <span class="mi">405</span>  <span class="c1"># 返回不支持的方法错误</span></div>

<span class="c1">#煤分类预测用户上传的数据</span>
<div class="viewcode-block" id="ClassifyUserCoalData"><a class="viewcode-back" href="../api/login.html#login.ClassifyUserCoalData">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/ClassifyUserCoalData&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">ClassifyUserCoalData</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    用户上传煤数据分类预测接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 如果使用 POST 方法上传数据，文件会被读取并根据预设模型进行分类预测。</span>
<span class="sd">        - 将 Excel 文件中的数据逐条读取，提取必要的参数。</span>
<span class="sd">        - 使用模型进行分类预测，并保存每条数据的预测结果。</span>
<span class="sd">        - 返回包含预测结果的 JSON 响应。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传煤数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        JSON: 返回包含预测结果的 JSON 格式响应，其中每条预测结果包含以下字段:</span>
<span class="sd">            - id (int): 样本的唯一标识。</span>
<span class="sd">            - name (str): 样本名称。</span>
<span class="sd">            - predicted_type (str): 预测的煤分类结果或 &quot;判据不足&quot;。</span>

<span class="sd">    示例:</span>
<span class="sd">        上传煤数据进行分类预测:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /ClassifyUserCoalData</span>
<span class="sd">            （请求应上传一个包含以下字段的 Excel 文件）</span>
<span class="sd">            </span>
<span class="sd">            Excel 数据示例:</span>
<span class="sd">            +----+------------+----------+-----+-----+-----+-----+-----+-----+</span>
<span class="sd">            | id | 煤样名称    | 煤样挥发分(Vdaf) | 氢(Hdaf) | G   | Y   | b/% |</span>
<span class="sd">            +----+------------+----------+-----+-----+-----+-----+-----+-----+</span>
<span class="sd">            | 1  | Coal A     | 25.3     | 5.6 | 1.2 | 3.4 | 0.9 |     |     |</span>
<span class="sd">            +----+------------+----------+-----+-----+-----+-----+-----+-----+</span>

<span class="sd">            返回:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;name&quot;: &quot;Coal A&quot;,</span>
<span class="sd">                    &quot;predicted_type&quot;: &quot;Type 1&quot;</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - 输入的 Excel 文件应符合指定格式，列名包括 &#39;煤样挥发分(Vdaf)&#39;, &#39;氢(Hdaf)&#39;, &#39;G&#39;, &#39;Y&#39;, &#39;b/%&#39;, &#39;煤样名称&#39;。</span>
<span class="sd">        - 如果某些字段缺失或数据格式不正确，可能导致预测失败。</span>
<span class="sd">        - 模型返回 `False` 表示判据不足，无法分类。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">classify_para</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 用于存储每条数据的参数</span>
        <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 读取的单条数据</span>
        <span class="n">classified_result</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 预测的单条数据</span>
        <span class="n">response_result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储所有预测结果的数组</span>
        <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;../src/assets/Upload_files/upload_coal.xlsx&quot;</span><span class="p">)</span>
        <span class="n">read_data</span> <span class="o">=</span> <span class="n">read_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>  <span class="c1"># 将NaN值替换成 &#39;_&#39;，以便于写入数据库</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row_</span> <span class="ow">in</span> <span class="n">read_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 跳过第一行</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;Vm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_</span><span class="p">[</span><span class="s1">&#39;煤样挥发分(Vdaf)&#39;</span><span class="p">]</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_</span><span class="p">[</span><span class="s1">&#39;氢(Hdaf)&#39;</span><span class="p">]</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_</span><span class="p">[</span><span class="s1">&#39;粘结指数(G)&#39;</span><span class="p">]</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
                <span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_</span><span class="p">[</span><span class="s1">&#39;b/%&#39;</span><span class="p">]</span>
                <span class="n">classify_para</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">)</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>  <span class="c1"># CSV文件头部</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;Sample.csv&#39;</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;Vm&#39;</span><span class="p">])</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">])</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">])</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para_dict</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># 将数据写入CSV文件</span>
                    <span class="n">f_csv</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="n">f_csv</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
                    <span class="n">f_csv</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

                <span class="c1"># 调用煤分类模型进行预测</span>
                <span class="n">single_result</span> <span class="o">=</span> <span class="n">coaltypefind</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

                <span class="n">classified_result</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">classified_result</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_</span><span class="p">[</span><span class="s1">&#39;煤样名称&#39;</span><span class="p">]</span>

                <span class="c1"># 处理模型返回False的情况</span>
                <span class="k">if</span> <span class="n">single_result</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">classified_result</span><span class="p">[</span><span class="s1">&#39;predicted_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;判据不足&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">classified_result</span><span class="p">[</span><span class="s1">&#39;predicted_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">response_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classified_result</span><span class="p">)</span>
                <span class="k">global</span> <span class="n">upload_classify_user</span>
                <span class="n">upload_classify_user</span> <span class="o">=</span> <span class="n">response_result</span>  <span class="c1"># 保存预测结果供其他使用</span>
                <span class="n">para_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 清空 para_dict，准备下一条数据</span>
                <span class="n">classified_result</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 清空 classified_result，准备下一条数据</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response_result</span><span class="p">)</span></div>

<span class="c1">#点击“用户上传煤分类结果按钮”上传结果至数据库</span>
<div class="viewcode-block" id="uploadUserClassifyResult"><a class="viewcode-back" href="../api/login.html#login.uploadUserClassifyResult">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uploadUserClassifyResult&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">uploadUserClassifyResult</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    用户上传煤样分类结果接口。</span>

<span class="sd">    处理逻辑:</span>
<span class="sd">        - 检查全局变量 `upload_classify_user` 是否包含分类结果。</span>
<span class="sd">        - 从上传的 Excel 文件中读取煤样数据。</span>
<span class="sd">        - 合并用户分类结果和煤样数据，根据模板填充每条记录。</span>
<span class="sd">        - 数据格式化后插入到数据库。</span>

<span class="sd">    参数:</span>
<span class="sd">        无（通过 POST 请求上传数据）。</span>

<span class="sd">    返回值:</span>
<span class="sd">        str: 返回 &quot;upload successfully&quot; 表示上传成功。</span>
<span class="sd">        如果发生异常，返回错误消息。</span>

<span class="sd">    示例:</span>
<span class="sd">        使用 POST 请求上传煤样分类结果:</span>
<span class="sd">        ::</span>
<span class="sd">            请求:</span>
<span class="sd">            POST /uploadUserClassifyResult</span>
<span class="sd">            文件路径: ../src/assets/Upload_files/upload_coal.xlsx</span>

<span class="sd">            返回:</span>
<span class="sd">            &quot;upload successfully&quot;</span>

<span class="sd">    注意事项:</span>
<span class="sd">        - `upload_classify_user` 必须包含每条煤样的分类结果。</span>
<span class="sd">        - 上传的 Excel 文件路径为 `../src/assets/Upload_files/upload_coal.xlsx`。</span>
<span class="sd">        - 数据中的 NaN 值将替换为 None。</span>
<span class="sd">        - 确保数据库事务成功提交。</span>

<span class="sd">    错误处理:</span>
<span class="sd">        - 如果文件读取或数据库操作失败，将返回详细的错误信息。</span>
<span class="sd">        - 未找到分类结果时返回错误提示。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">upload_classify_user</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># 初始化煤样数据字典</span>
        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coal_name&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_belong&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_type&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_price&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_13mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_13_10mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_10_8mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_8_6mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_6_5mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_5_4mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_4_3mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_3_2mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_2_1mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_1_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma_coal_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_6mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_6_5mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_5_4mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_4_3mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_3_2mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_2_1mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_1_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma_coal_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_mad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_fcd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ada&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_fcad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_std&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_had&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_cad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_nad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_oad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_hd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_cd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_nd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_od&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_hdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_cdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_ndaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_odaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;G&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;X&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Y&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T1&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tmax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tk&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;amax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tk_Tp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;DT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ST&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;HT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;FT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;SiO2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Al2O3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Fe2O3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;CaO&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;MgO&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;P2O5&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Na2O&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;K2O&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;TiO2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;SO3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ash_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;V&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;I&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;E&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;live_idle_ratio&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Rmax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;micro_var&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;micro_type&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;oven_type&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_style&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;dry_quality&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;heap_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;oven_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;up_temper&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;down_number&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;hot_coke_qulity&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;hot_ratio_coke&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;quench_coke_weight&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ratio_coke&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_date&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_process_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_start_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_100_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_500_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_900_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_end_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_end_temp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_mad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_ad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fcd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_aad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fcad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_std&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_80mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_80_60mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_60_40mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_40_25mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_25_20mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_20_10mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_10mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_5mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_sum&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_60mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M40&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M25&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M10&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_CRI&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_CSR&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_DT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_ST&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_HT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_FT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_750&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_800&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_850&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_900&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_950&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1000&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1050&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1100&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1150&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1200&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_apparent_porosity&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_real_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fake_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_total_ratio&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="c1"># 读取上传的Excel文件并填充缺失值</span>
        <span class="n">read_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;../src/assets/Upload_files/upload_coal.xlsx&quot;</span><span class="p">)</span>
        <span class="n">read_data</span> <span class="o">=</span> <span class="n">read_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="c1"># 将nan替换成_以便于写入mysql数据库</span>
        <span class="n">upload_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># 用来存储上传煤数据的数量</span>
        <span class="c1"># 遍历数据并处理每一行</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">read_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样名称&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">upload_classify_user</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;predicted_type&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;价格(吨)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样水分(Mad)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样灰分(Ad)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样挥发分(Vdaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_fcd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样固定碳(FCd)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;煤样硫分(St,d)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_hdaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;氢(Hdaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_cdaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;碳(Cdaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_ndaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;氮(Ndaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_odaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;氧(Odaf)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;粘结指数(G)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;a/%&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;b/%&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tp/℃&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tmax/℃&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tk/℃&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;amax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;αmax/度/分&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tk_Tp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tk-Tp&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;变形温度(DT)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;ST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;软化温度(ST)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;HT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;半球温度(HT)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;FT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;流动温度(FT)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;SiO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;SiO2&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Al2O3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Al2O3&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Fe2O3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Fe2O3&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CaO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CaO&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;MgO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;MgO&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;P2O5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;P2O5&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Na2O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Na2O&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;K2O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;K2O&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;TiO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;TiO2&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;SO3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;SO3&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;镜质组(V)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;惰质组(I)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;壳质组(E)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;矿物(M)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;live_idle_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;活惰比&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Rmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;平均最大反射率(Rmax)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;micro_var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;标准方差&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;micro_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;类型&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;oven_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;炉型&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;dry_quality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;入炉干基质量/kg&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;heap_density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;堆密度t/m³&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;oven_moi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;入炉煤水分%&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;炼焦日期&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;入炉时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_100_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;中心到100℃时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_500_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;中心到500℃时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_900_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;中心到900℃时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;出炉时间&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_end_temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;出炉中心温度℃&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_mad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;焦炭水分(Mad)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_ad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;焦炭灰分(Ad)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;焦炭硫分(St,d)&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M40&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;M40&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M25&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;M25&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;M10&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CRI&#39;</span><span class="p">]</span>
                <span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;CSR&#39;</span><span class="p">]</span>

                <span class="c1"># 检查字典中每个值，若是&#39;_&#39;则转换为None</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span> <span class="c1"># 将_识别的出的对应nan都转换成None</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> 

                <span class="c1"># 生成煤样数据实例并添加到列表</span>
                <span class="n">new_coal_data</span><span class="o">=</span> <span class="n">CoalDataGeneration</span><span class="p">(</span><span class="n">coal_name</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_name&#39;</span><span class="p">],</span><span class="n">coal_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_type&#39;</span><span class="p">],</span><span class="n">coal_price</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_price&#39;</span><span class="p">],</span><span class="n">coal_mad</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_mad&#39;</span><span class="p">],</span><span class="n">coal_ad</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_ad&#39;</span><span class="p">],</span><span class="n">coal_vdaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_vdaf&#39;</span><span class="p">],</span><span class="n">coal_fcd</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_fcd&#39;</span><span class="p">],</span><span class="n">coal_std</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_std&#39;</span><span class="p">],</span><span class="n">coal_drynoash_hdaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_hdaf&#39;</span><span class="p">],</span><span class="n">coal_drynoash_cdaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_cdaf&#39;</span><span class="p">],</span><span class="n">coal_drynoash_ndaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_ndaf&#39;</span><span class="p">],</span><span class="n">coal_drynoash_odaf</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coal_drynoash_odaf&#39;</span><span class="p">],</span><span class="n">G</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">],</span><span class="n">X</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">Y</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">a</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span><span class="n">b</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span><span class="n">Tp</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tp&#39;</span><span class="p">],</span><span class="n">Tmax</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tmax&#39;</span><span class="p">],</span><span class="n">Tk</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tk&#39;</span><span class="p">],</span><span class="n">amax</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;amax&#39;</span><span class="p">],</span><span class="n">Tk_Tp</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Tk_Tp&#39;</span><span class="p">],</span><span class="n">DT</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;DT&#39;</span><span class="p">],</span><span class="n">ST</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;ST&#39;</span><span class="p">],</span><span class="n">HT</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;HT&#39;</span><span class="p">],</span><span class="n">FT</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;FT&#39;</span><span class="p">],</span><span class="n">SiO2</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;SiO2&#39;</span><span class="p">],</span><span class="n">Al2O3</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Al2O3&#39;</span><span class="p">],</span><span class="n">Fe2O3</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Fe2O3&#39;</span><span class="p">],</span><span class="n">CaO</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;CaO&#39;</span><span class="p">],</span><span class="n">MgO</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;MgO&#39;</span><span class="p">],</span><span class="n">P2O5</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;P2O5&#39;</span><span class="p">],</span><span class="n">Na2O</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Na2O&#39;</span><span class="p">],</span><span class="n">K2O</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;K2O&#39;</span><span class="p">],</span><span class="n">TiO2</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;TiO2&#39;</span><span class="p">],</span><span class="n">SO3</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;SO3&#39;</span><span class="p">],</span><span class="n">V</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">],</span><span class="n">I</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span><span class="n">E</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span><span class="n">M</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">],</span><span class="n">live_idle_ratio</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;live_idle_ratio&#39;</span><span class="p">],</span><span class="n">Rmax</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;Rmax&#39;</span><span class="p">],</span><span class="n">micro_var</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;micro_var&#39;</span><span class="p">],</span><span class="n">micro_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;micro_type&#39;</span><span class="p">],</span><span class="n">oven_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;oven_type&#39;</span><span class="p">],</span><span class="n">dry_quality</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;dry_quality&#39;</span><span class="p">],</span><span class="n">heap_density</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;heap_density&#39;</span><span class="p">],</span><span class="n">oven_moi</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;oven_moi&#39;</span><span class="p">],</span><span class="n">coking_date</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_date&#39;</span><span class="p">],</span><span class="n">coking_start_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_start_time&#39;</span><span class="p">],</span><span class="n">center_100_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_100_time&#39;</span><span class="p">],</span><span class="n">center_500_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_500_time&#39;</span><span class="p">],</span><span class="n">center_900_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;center_900_time&#39;</span><span class="p">],</span><span class="n">coking_end_time</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_end_time&#39;</span><span class="p">],</span><span class="n">coking_end_temp</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coking_end_temp&#39;</span><span class="p">],</span><span class="n">coke_mad</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_mad&#39;</span><span class="p">],</span><span class="n">coke_ad</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_ad&#39;</span><span class="p">],</span><span class="n">coke_std</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_std&#39;</span><span class="p">],</span><span class="n">coke_M40</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M40&#39;</span><span class="p">],</span><span class="n">coke_M25</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M25&#39;</span><span class="p">],</span><span class="n">coke_M10</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_M10&#39;</span><span class="p">],</span><span class="n">coke_CRI</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_CRI&#39;</span><span class="p">],</span><span class="n">coke_CSR</span><span class="o">=</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;coke_CSR&#39;</span><span class="p">])</span>
                <span class="n">upload_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_coal_data</span><span class="p">)</span> <span class="c1"># 将所有所有数据存入列表中</span>
                <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coal_name&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_belong&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_type&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;coal_price&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_13mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_13_10mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_10_8mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_8_6mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_6_5mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_5_4mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_4_3mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;ori_coal_3_2mm&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_2_1mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_1_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ori_coal_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma_coal_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_6mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_6_5mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_5_4mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_4_3mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_3_2mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_2_1mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_1_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_05mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma__coal_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;sma_coal_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_mad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_fcd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ada&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_vad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_fcad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_std&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_had&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_cad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_nad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_ana_oad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_hd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_cd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_nd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_dry_od&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_hdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_cdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_ndaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coal_drynoash_odaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;G&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;X&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Y&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T1&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;T3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tmax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tk&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;amax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Tk_Tp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;DT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ST&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;HT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;FT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;SiO2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Al2O3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Fe2O3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;CaO&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;MgO&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;P2O5&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Na2O&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;K2O&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;TiO2&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;SO3&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ash_total&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;V&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;I&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;E&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;live_idle_ratio&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;Rmax&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;micro_var&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;micro_type&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;oven_type&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_style&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;dry_quality&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;heap_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;oven_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;up_temper&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;down_number&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;hot_coke_qulity&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;hot_ratio_coke&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;quench_coke_weight&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_moi&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;ratio_coke&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_date&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_process_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_start_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_100_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_500_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;center_900_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_end_time&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coking_end_temp&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_mad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_ad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vdaf&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fcd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vd&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_aad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_vad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fcad&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_std&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_80mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_80_60mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_60_40mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_40_25mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_25_20mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_20_10mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_10mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_5mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_sum&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_60mm&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fineness&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M40&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M25&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_M10&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_CRI&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_CSR&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_DT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_ST&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_HT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_FT&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_750&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_800&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_850&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_900&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_950&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1000&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1050&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1100&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1150&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_1200&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_apparent_porosity&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_real_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_fake_density&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;coke_total_ratio&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        
        <span class="c1"># 将所有数据插入到数据库</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">(</span><span class="n">upload_list</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="s1">&#39;upload successfully&#39;</span></div>

<span class="kn">from</span> <span class="nn">memory_profiler</span> <span class="kn">import</span> <span class="n">profile</span>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../api/login.html#login.main">[docs]</a><span class="nd">@profile</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># 主函数内容，例如加载模型、启动训练等</span>
    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model created&quot;</span><span class="p">)</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;JSON_AS_ASCII&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Yuhang Qiu, Haodong Liu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>